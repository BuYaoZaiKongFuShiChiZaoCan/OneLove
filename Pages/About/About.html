<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ç¥å¯Œå¼º - å£¹æ¯”é›¶</title>
	<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
	<meta name="description" content="æè¿°">
	<meta name="keywords" content="å…³é”®è¯,ç¥å¯Œå¼º,Re01æˆå‘˜,å…ƒå²›ç¤¾åŒºç®¡ç†å‘˜,ç”˜è‚ƒä¸å¤§,åˆ›é€ ç¥è¯,DAO,æ¢—">
	<meta name="copyright" content="ç¥å¯Œå¼º">
	<meta name="author" content="ç¥å¯Œå¼º">
	<meta property="og:image" content="../../images/logo.png">
	<meta name="og:title" content="ç¥å¯Œå¼º">
	<meta name="og:url" content="http://apicloud.fun">
	<meta name="og:description" content="">
	<meta name="apple-mobile-web-app-title" content="ç¥å¯Œå¼º">

	<!-- Markdown è§£æåº“ -->
	<script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.1/dist/purify.min.js"></script>

	<style>
		:root {
			--icon-size: 50px;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		marquee span {
			color: #16A085;
		}

		marquee {
			width: 300px;
		}

		::-webkit-scrollbar {
			display: none;
		}

		body {
			color: #FFFFFF;
			font-size: 18px;
			background: #34495E;
			display: flex;
			align-items: center;
			flex-direction: column;
			min-height: 100vh;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}

		header,
		footer {
			width: 100%;
			padding: 40px 0;
			background: #2F4254;
			text-align: center;
		}

		header button {
			background: none;
		}

		header div:nth-of-type(2) {
			display: flex;
			flex-direction: row;
			flex-wrap: nowrap;
			justify-content: center;
			align-items: center;
		}

		header div:nth-of-type(2) button:nth-of-type(1) {
			margin-right: 10px;
		}

		header div:nth-of-type(2) button:nth-of-type(2) {
			margin-left: 10px;
			border-color: #16A085;
		}

		footer {
			font-size: 14px;
			margin-top: 50px;
		}

		a {
			color: #FFFFFF;
			text-decoration: none;
		}

		a:hover {
			text-decoration: underline;
		}

		button {
			color: #FFFFFF;
			background: none;
			border-radius: 10px;
			width: 120px;
			height: 40px;
			position: relative;
			z-index: 8;
			border: 2px solid #16A085;
			cursor: pointer;
			transition: all 0.3s ease;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			font-weight: bold;
		}

		button:hover {
			transform: translateY(-2px);
			background: rgba(22, 160, 133, 0.8);
			box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
		}

		button:active {
			transform: translateY(0);
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}

		article {
			margin: 50px;
			max-width: 1200px;
			text-align: justify;
			width: 100%;
		}

		article>h3 {
			width: 20%;
			transition: all .3s;
			margin-bottom: 30px;
			border-bottom: 3px solid #DDD;
			color: #16A085;
			font-size: 24px;
		}

		article>h3:hover {
			width: 100%;
			border-bottom: 3px dashed rgb(119, 82, 250);
		}

		article .content div {
			text-indent: 2em;
			margin-bottom: 15px;
			line-height: 1.6;
		}

		article .content pre {
			white-space: pre-wrap;
			padding: 1em;
		}

		details {
			text-align: center;
			margin: 20px 0;
		}

		details :not(video) {
			text-align: left;
		}

		/* Changelogç¼–è¾‘æŒ‰é’®æ‚¬åœæ ·å¼ */
		.changelog-item-with-edit {
			position: relative;
			transition: background-color 0.3s ease, transform 0.3s ease;
		}

		/* æ‚¬åœæ—¶æ·»åŠ èƒŒæ™¯æ ·å¼ */
		.changelog-item-with-edit:hover {
			background-color: rgba(22, 160, 133, 0.1);
			transform: translateY(-2px);
		}

		.changelog-edit-button {
			opacity: 0;
			transition: opacity 0.3s ease;
		}

		.changelog-item-with-edit button {
			width: auto;
			height: auto;
		}

		/* æ‚¬åœæ—¶æ˜¾ç¤ºç¼–è¾‘/åˆ é™¤æŒ‰é’® */
		.changelog-item-with-edit:hover .changelog-edit-button {
			color: #000;
			opacity: 1;
			transition: all cubic-bezier(0.075, 0.82, 0.165, 1) 0.3s;
			transform: translateY(-50%);
		}

		.changelog-item-with-edit:hover .changelog-edit-button:hover {
			transform: translateY(-55%) scale(1.1);
		}

		/* ç¼–è¾‘æŒ‰é’®æ‚¬åœæ•ˆæœ */
		.changelog-edit-button:hover {
			background-color: #16A085;
			transform: scale(1.05);
		}

		/* æ—¶é—´æ˜¾ç¤ºæ ·å¼ */
		.Ttime:not(:empty),
		.itemTime:not(:empty) {
			display: inline-block;
			min-width: 171px;
			border-radius: 4px;
			font-size: 0.9em;
		}

		/* åˆ é™¤é‡å¤çš„æ ·å¼è§„åˆ™ */
		.changelog-edit-button {
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
		}

		/* å­æ¡ç›®æ ·å¼ - æ‚¬åœæ•ˆæœ */
		.changelog-item-with-edit {
			position: relative;
			transition: background-color 0.3s ease, transform 0.3s ease;
			display: grid;
			grid-template-columns: 171px 1fr;
			column-gap: 10px;
			align-items: start;
		}

		.changelog-item-with-edit:hover {
			background-color: rgba(22, 160, 133, 0.1);
		}

		/* ç¼–è¾‘å’Œåˆ é™¤æŒ‰é’®æ ·å¼ */
		.changelog-edit-button {
			opacity: 0;
			position: absolute;
			right: 5px;
			top: 50%;
			transform: translateY(-50%);
			transition: opacity 0.3s ease, background-color 0.3s ease;
			padding: 4px 8px;
			border: none;
			border-radius: 4px;
			cursor: pointer;
		}

		.changelog-edit-button.delete {
			right: 80px;
		}

		/* è®©æ¢è¡Œæ–‡æœ¬ä¸é¦–è¡Œå¯¹é½ï¼ˆæ—¶é—´åœ¨ç¬¬ä¸€åˆ—ï¼Œå†…å®¹åœ¨ç¬¬äºŒåˆ—ï¼‰ */
		.changelog-item-with-edit>.Ttime {
			grid-column: 1;
			position: sticky;
			top: 3rem;
		}

		.changelog-item-with-edit>span {
			grid-column: 2;
			white-space: pre-wrap;
		}

		/* å†…å®¹è§£ææ ·å¼ */
		.parsed-content {
			line-height: 1.6;
		}

		.parsed-content h1,
		.parsed-content h2,
		.parsed-content h3,
		.parsed-content h4,
		.parsed-content h5,
		.parsed-content h6 {
			margin: 10px 0 5px 0;
			color: #16A085;
			font-weight: 600;
		}

		.parsed-content h1 {
			font-size: 1.4em;
		}

		.parsed-content h2 {
			font-size: 1.3em;
		}

		.parsed-content h3 {
			font-size: 1.2em;
		}

		.parsed-content h4 {
			font-size: 1.1em;
		}

		.parsed-content h5 {
			font-size: 1.0em;
		}

		.parsed-content h6 {
			font-size: 0.9em;
		}

		.parsed-content p {
			margin: 8px 0;
		}

		.parsed-content ul,
		.parsed-content ol {
			margin: 8px 0;
			padding-left: 20px;
		}

		.parsed-content li {
			margin: 4px 0;
		}

		.parsed-content blockquote {
			border-left: 4px solid #16A085;
			margin: 10px 0;
			padding: 10px 15px;
			background-color: rgba(22, 160, 133, 0.1);
			border-radius: 0 4px 4px 0;
		}

		.parsed-content code {
			background-color: rgba(255, 255, 255, 0.1);
			padding: 2px 6px;
			border-radius: 3px;
			font-family: 'Courier New', monospace;
			font-size: 0.9em;
		}

		.parsed-content pre {
			background-color: rgba(0, 0, 0, 0.2);
			padding: 10px;
			border-radius: 4px;
			overflow-x: auto;
			margin: 10px 0;
		}

		.parsed-content pre code {
			background: none;
			padding: 0;
		}

		.parsed-content a {
			color: #16A085;
			text-decoration: underline;
		}

		.parsed-content a:hover {
			color: #1abc9c;
		}

		.parsed-content strong {
			font-weight: 600;
			color: #16A085;
		}

		.parsed-content em {
			font-style: italic;
		}

		.parsed-content img {
			max-width: 100%;
			height: auto;
			border-radius: 4px;
			margin: 10px 0;
		}

		.parsed-content table {
			border-collapse: collapse;
			width: 100%;
			margin: 10px 0;
		}

		.parsed-content th,
		.parsed-content td {
			border: 1px solid rgba(255, 255, 255, 0.2);
			padding: 8px;
			text-align: left;
		}

		.parsed-content th {
			background-color: rgba(22, 160, 133, 0.2);
			font-weight: 600;
		}

		/* å†…å®¹ç±»å‹æŒ‡ç¤ºå™¨ */
		.content-type-indicator {
			font-size: 0.7em;
			color: #95a5a6;
			margin-left: 5px;
			font-style: italic;
		}

		.changelog-edit-:hover {
			background-color: #16A085;
			color: white;
		}

		/* æ—¶é—´è½´æ ·å¼ - æ¢å¤åˆ°ä¹‹å‰çš„è®¾è®¡ */
		.timeline {
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
			scroll-behavior: smooth;
			/* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
			scrollbar-width: thin;
			scrollbar-color: #16A085 #34495E;
		}

		/* Webkitæµè§ˆå™¨çš„æ»šåŠ¨æ¡æ ·å¼ */
		.timeline::-webkit-scrollbar {
			width: 8px;
		}

		.timeline::-webkit-scrollbar-track {
			background: #34495E;
			border-radius: 4px;
		}

		.timeline::-webkit-scrollbar-thumb {
			background: #16A085;
			border-radius: 4px;
		}

		.timeline::-webkit-scrollbar-thumb:hover {
			background: #138D75;
		}



		/* æ»šåŠ¨æŒ‡ç¤ºå™¨ */
		.scroll-indicator {
			position: fixed;
			right: 20px;
			bottom: 20px;
			background: #16A085;
			color: white;
			width: 50px;
			height: 50px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			opacity: 0;
			transition: opacity 0.3s ease;
			z-index: 1000;
			box-shadow: 0 4px 15px rgba(22, 160, 133, 0.3);
		}

		.scroll-indicator.visible {
			opacity: 1;
		}

		.scroll-indicator:hover {
			background: #138D75;
			transform: scale(1.1);
		}

		.timeline .item {
			position: relative;
			margin-top: 50px;
			display: flex;
			flex-wrap: nowrap;
		}

		.timeline .item:first-of-type {
			margin-top: 0;
		}

		.timeline .item .left {
			margin-right: var(--icon-size);
		}

		.timeline .item .left .icon {
			font-size: var(--icon-size);
			color: #16A085;
			position: sticky;
			top: 0;
			background: #34495E;
		}

		/* è¿æ¥çº¿ - ä»å›¾æ ‡ä¸­å¿ƒåˆ°ä¸‹ä¸€ä¸ªå›¾æ ‡ä¸­å¿ƒ */
		.timeline .item:not(:last-of-type) .left::after {
			content: '';
			display: block;
			width: 0px;
			height: calc(100% - 4rem);
			border: 1px dashed;
			margin: auto;
			margin-top: 1rem;
		}

		.timeline .item .right {
			width: 100%;
			text-align: justify;
			background: white;
			border-radius: 12px;
		}

		.timeline .item .right h4 {
			display: flex;
			flex-wrap: nowrap;
			flex-direction: row;
			align-items: center;
			justify-content: space-between;
			padding: 10px;
			border-bottom-left-radius: 10px;
			border-bottom-right-radius: 10px;
			background: rebeccapurple;
			position: sticky;
			top: 0;
			z-index: 10;
		}

		.timeline .item .right h4 span {
			margin-left: 2em;
		}

		.timeline .item .right .content {
			margin: 10px;
			color: #000;
		}

		.timeline .item .right .content p {
			margin: 10px;
		}

		.timeline .item .right .content ol {
			margin: 10px;
			padding-left: 20px;
		}

		.timeline .item .right .content ol li {
			margin: 5px 0;
			line-height: 1.6;
		}

		.timeline .item .right .images {
			margin: 10px;
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
		}

		.timeline .item .right .images img {
			max-width: 90vmin;
			max-height: 88vmin;
			width: auto;
			height: auto;
			border-radius: 8px;
			border: 2px solid #ddd;
		}

		.timeline .item .right .videos {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
		}

		.timeline .item .right .content video {
			width: 100vmin;
			height: 98vmin;
			border-radius: 5px;
		}

		.Ttime {
			color: #16A085;
		}

		/* æ“ä½œæŒ‰é’®æ ·å¼ */
		.timeline-actions {
			margin: 20px;
			display: flex;
			gap: 10px;
			justify-content: flex-end;
		}

		.timeline-actions {
			background: rgba(52, 152, 219, 0.8);
			border: none;
			padding: 5px 10px;
			border-radius: 5px;
			cursor: pointer;
			font-size: 12px;
			width: auto;
			height: auto;
		}

		.timeline-actions :last-child {
			background: rgba(231, 76, 60, 0.8);
		}

		/* å“åº”å¼è®¾è®¡ */
		@media (max-width: 768px) {
			article {
				margin: 20px;
			}

			.timeline {
				padding: 10px;
			}

			.timeline::before {
				left: 30px;
			}

			.timeline .item {
				flex-direction: column;
				align-items: center;
				text-align: center;
			}

			.timeline .left {
				margin-right: 0;
				margin-bottom: 15px;
				width: 60px;
				height: 60px;
				font-size: 20px;
			}

			.timeline .right h4 {
				flex-direction: column;
				gap: 10px;
			}

			.timeline .images {
				grid-template-columns: 1fr;
			}

			.timeline .videos {
				grid-template-columns: 1fr;
			}
		}


		/* ä¿®å¤æŒ‰é’®æ ·å¼å†²çª */
		.timeline button:not(.timeline-actions button),
		.add-timeline-form button,
		.edit-timeline-form button {
			width: auto !important;
			height: auto !important;
			border: none !important;
			background: none !important;
			backdrop-filter: blur(10px);
		}

		/* ç¡®ä¿è¡¨å•å…ƒç´ æ­£ç¡®æ˜¾ç¤º */
		.add-timeline-form input,
		.add-timeline-form textarea,
		.add-timeline-form select,
		.edit-timeline-form input,
		.edit-timeline-form textarea,
		.edit-timeline-form select {
			width: 100% !important;
			padding: 10px !important;
			border: 1px solid rgba(255, 255, 255, 0.3) !important;
			border-radius: 5px !important;
			background: rgba(255, 255, 255, 0.1) !important;
			color: white !important;
			font-size: 14px !important;
			margin-bottom: 15px !important;
		}

		/* ç¡®ä¿æ“ä½œæŒ‰é’®æ­£ç¡®æ˜¾ç¤º */
		.timeline-actions {
			background: rgba(52, 152, 219, 0.8) !important;
			border: none !important;
			padding: 5px 10px !important;
			border-radius: 5px !important;
			cursor: pointer !important;
			font-size: 12px !important;
			width: auto !important;
			height: auto !important;
		}

		.timeline-actions :last-child {
			background: rgba(231, 76, 60, 0.8) !important;
		}

		/* æ¨¡æ€æ¡†æ ·å¼ */
		.modal-overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.9);
			display: flex;
			align-items: center;
			justify-content: center;
			z-index: 1000;
			cursor: pointer;
		}

		.modal-image {
			max-width: 90%;
			max-height: 90%;
			object-fit: contain;
		}

		/* ç§æœ‰æ ‡è¯†æ ·å¼ */
		.private-badge {
			position: absolute;
			top: -10px;
			right: 20px;
			background: #e74c3c;
			color: white;
			padding: 4px 8px;
			border-radius: 12px;
			font-size: 12px;
			z-index: 10;
		}

		/* é˜²æ­¢é•¿æ–‡æœ¬æº¢å‡º */
		.changelog-item-with-edit > span{display:block;white-space:pre-wrap;overflow-wrap:anywhere;word-break:break-word;max-width:100%}
		.right,.right .content{min-width:0}
		.timeline-empty{opacity:.75;padding:8px 0;color:#9aa3ab}
	</style>
</head>

<body>
	<header>
		<a href="../../index.html">
			<img src="../../images/logo.png" alt="" style="border-radius: 50%; width: 360px; height: 360px; object-fit: cover;">
		</a>
		<div>
			<h3>å…³äº</h3>
			<marquee behavior="summary" direction="1000">
				å£¹æ¯”é›¶ <span>&lt;/&gt;</span>
				&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
				ç‚¹å¤´åƒè¿›å…¥é¦–é¡µ <span>&lt;/&gt;</span>
				&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
				æ¬¢è¿â”(*ï½€âˆ€Â´*)ãƒäº»! <span>&lt;/&gt;</span>
			</marquee>
		</div>
		<div>
			<button>
				<a href="./personalResume.html">(oï¾Ÿâ–½ï¾Ÿ)oæˆ‘çš„ç®€ä»‹</a>
			</button>
			<button>
				<a href="https://qaiji.gitee.io/yuandao-learning/#/">â˜ˆ ç•™è¨€</a>
			</button>
		</div>
	</header>
	<article>
		<h3>. æ˜¯åŒ¿è¶å– .</h3>
		<div class="content">
			<div>åœ¨åº§çš„å„ä½åŒå¿—ï¼Œå¤§å®¶å¥½ï¼Œæˆ‘æ˜¯<strong>å£¹æ¯”é›¶</strong>çš„ä½œè€…ï¼šç¥å¯Œå¼ºï¼Œç”Ÿäº2004å¹´5æœˆ15æ—¥ã€‚å·æ¥è‡ªç”˜è‚ƒ(ä¸å¤§ï¼Œåˆ›é€ ç¥è¯)ã€‚</div>
			<div>æ ¹æ®æˆ‘çš„ä¸“ä¸šå¾—çŸ¥è¿™ä¸ªé”€å”®å¾ˆé‡è¦ã€è¥é”€æ›´é‡è¦ï¼Œæ‰€ä»¥æˆ‘è¦è¥é”€è‡ªå·±ï¼Œå“å°±æ˜¯ç©å„¿ï¼Œéå¸¸çš„niceå¥½å§ã€‚</div>
			<div>
				<div>ä¸å¼€ç©ç¬‘äº†ï¼Œä½œä¸ºå…ƒDAOç®¡ç†å‘˜ï¼Œæ­£ç»çš„å®£å¸ƒä¸€ä»¶äº‹</div>
				<details>
					<summary>ç‚¹å‡»å±•å¼€</summary>
					<div>
						æˆ‘ä¸ªäººè®¤ä¸ºè¿™ä¸ªæ„å¤§åˆ©é¢å°±åº”è¯¥æ‹Œ42å·æ··å‡åœŸï¼Œå› ä¸ºè¿™ä¸ªèºä¸é’‰çš„é•¿åº¦ï¼Œå®ƒå¾ˆå®¹æ˜“ä¼šç›´æ¥å½±å“åˆ°æŒ–æ˜æœºçš„æ‰­çŸ©ï¼Œä½ çŸ¥é“å§?ä½ å¾€é‡Œç ¸çš„æ—¶å€™ï¼Œä¸€ç¬é—´å®ƒå°±ä¼šäº§ç”Ÿå¤§é‡çš„é«˜èƒ½è›‹ç™½ï¼Œä¿—ç§°UFOï¼Œ
						ä¼šä¸¥é‡å½±å“ç»æµçš„å‘å±•ï¼Œç”šè‡³å¯¹è¿™ä¸ªå¤ªå¹³æ´‹ä»¥åŠå……ç”µå™¨éƒ½ä¼šé€ æˆä¸€å®šçš„æ ¸æ±¡æŸ“
					</div>
					<video src="./mp4/å§é¾™å‡¤é›.mp4" height="600vh" controls preload="metadata"></video><!-- metadataä»…åŠ è½½å…ƒæ•°æ® -->
					<div>çœ‹å®Œè§†é¢‘ï¼Œå¤§å®¶åº”è¯¥æ‡‚ä»€ä¹ˆå«çˆ±æƒ…äº†å§(*^â–½^*)</div>
				</details>
			</div>
			<div>å…¶å®ä½ å¯èƒ½è§‰å¾—è¿™å¹¶æ²¡æœ‰ä»€ä¹ˆï¼Œä½†æ²¡å…³ç³»ï¼Œå› ä¸ºä½ çš„æ„Ÿè§‰æ˜¯å¯¹çš„ã€‚æ¯•ç«Ÿäººæ¯å‘¼å¸å…­åç§’ï¼Œç”Ÿå‘½å°±ä¼šå‡å°‘ä¸€åˆ†é’Ÿï¼Œä½ åœ¨è¿™å¾…äº†5åˆ†é’Ÿï¼Œå°±ç¬‘äº†4åˆ†é’Ÿï¼Œè¿˜æœ‰ä¸€åˆ†é’Ÿä¸ºä½ æµªè´¹äº†5åˆ†é’Ÿè€Œå¹æ¯ã€‚ç„¶åæ¥ç€åº¦è¿‡ä¸‹ä¸€ä¸ªäº”åˆ†é’Ÿ</div>
			<div>é‚£æ ¹æ®å¤§å®¶éƒ½çŸ¥é“æ¯ä¸ªäººèº«ä¸Šéƒ½æœ‰æ¯›æ¯›ï¼Œè®©æˆ‘ä¸ºä½ å”±å¹´è½»äººä¸è®²æ­¦å¾·ï¼Œè€—å­å°¾æ±ï¼Œå¾—çŸ¥å¥‡æ€ªçš„çŸ¥è¯†å¢åŠ äº†ï¼Œæˆ‘åªå¸Œæœ›çœ‹åˆ°è¿™é‡Œä½ ä¸è¦ç»™æˆ‘ææ„è§ï¼Œä¸ç„¶æˆ‘ä¼šä»¥ä¸º ä½ åœ¨æ•™æˆ‘åšäº‹ï¼Ÿ</div>
			<!-- <div>å…¶å®æˆ‘å¹¶ä¸å–œæ¬¢é‚£ç§ä»€ä¹ˆä½“è´¨å†…å•Šï¼Œæ´—è„‘å•Šä»€ä¹ˆçš„ï¼Œå› ä¸ºæ¯ä¸ªäººéƒ½è¦æœ‰è‡ªå·±çš„ç”Ÿæ´»æ–¹å¼ï¼Œå¤–å›½äººè‡ªç”±ä¹ŸæŒºå¥½çš„ï¼Œä½†åº”è¯¥ç»“åˆï¼Œæˆ–è€…è¯´å¯ä»¥æ›¿æ¢ã€‚å¹³æ°‘å°±ç”±æœºå™¨äººå»ä¾›å…»ï¼Œå¢åŠ æ€æƒ³ä¸Šçš„çŸ¥è¯†ï¼Œè€Œä¸æ˜¯ä¸€å‘³çš„åªçŸ¥é“è¿›å‚æ´—è„‘ï¼ŒæŒºå¯æ‚²çš„ã€‚è¯´èµ·æ¥å°±æ˜¯æ²¡æœ‰ç»™åˆ°æ­£åé¦ˆï¼Œä»–ä»¬çš„è¡Œä¸ºå°±æ˜¯ä»¥æ¶åˆ¶æ¶ï¼Œé™·å…¥æ¶æ€§å¾ªç¯ã€‚</div> -->
			<!-- <div>å†å¹´æ¢—</div> -->
		</div>
		<br />
		<br />
		<!-- æ—¶é—´è½´ -->
		<h3 id="MyPast">. My past .</h3>
		<div style="text-align: right; margin-bottom: 10px;">
			<button id="addMyPastBtn" style="display: none; background: #16A085; color: white; border: none; box-sizing: content-box; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
				â• æ·»åŠ æ–°é¡¹ç›®
			</button>
			<button onclick="checkTokenContent()" style="background: #3498db; color: white; border: none; box-sizing: content-box; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-left: 10px;">
				ğŸ” æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯
			</button>
			<button onclick="clearAllCache()" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-left: 10px;">
				ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜
			</button>
		</div>
		<div class="timeline" id="myPastContainer">
			<!-- åŠ¨æ€æ¸²æŸ“å†…å®¹ -->
		</div>
		<!-- æ±‰å­è°ƒç» - E6KB -->
		<h3 id="æ±‰å­è°ƒç»">. è°ƒç» .</h3>
		<div style="text-align: right; margin-bottom: 10px;">
			<button id="addHealthBtn" style="display: none; background: #16A085; color: white; border: none; box-sizing: content-box; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
				â• æ·»åŠ æ–°é¡¹ç›®
			</button>
		</div>
		<div class="timeline" id="healthContainer">
			<!-- åŠ¨æ€æ¸²æŸ“å†…å®¹ -->
		</div>
		<!-- å†å²æ›´æ–° -->
		<h3 id="æ›´æ–°æ—¥å¿—">. æ›´æ–°æ—¥å¿— .</h3>
		<div style="text-align: right; margin-bottom: 10px;">
			<button id="addChangelogBtn" style="display: none; background: #16A085; color: white; border: none; box-sizing: content-box; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
				â• æ·»åŠ æ–°ç‰ˆæœ¬
			</button>
		</div>
		<div class="timeline" id="versionLogContainer">
			<div style="text-align: center; padding: 20px;">
				<i class="fas fa-spinner fa-spin"></i> æ­£åœ¨åŠ è½½ç‰ˆæœ¬ä¿¡æ¯...
			</div>
		</div>
		<script>
			// é…ç½®APIåŸºç¡€URL
			// é…ç½®APIåŸºç¡€URL
			window.OneLoveConfig = { apiBaseUrl: '/api' };
			console.log('APIåŸºç¡€URL:', window.OneLoveConfig.apiBaseUrl);

			/**
			 * ä»APIè·å–changelogæ•°æ®
			 */
			async function loadChangelogFromAPI() {
				try {
					const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';
					const response = await fetch(`${apiBaseUrl}/changelog?limit=100`);
					const result = await response.json();

					if (result.success && result.data.changelogs) {
						const versionLogs = result.data.changelogs;
						return versionLogs; // åªè¿”å›æ•°æ®ï¼Œä¸æ¸²æŸ“
					} else {
						throw new Error('è·å–ç‰ˆæœ¬ä¿¡æ¯å¤±è´¥');
					}
				} catch (error) {
					console.error('åŠ è½½changelogå¤±è´¥:', error);
					document.getElementById('versionLogContainer').innerHTML =
						'<div style="text-align: center; padding: 20px; color: #ff6b6b;">' +
						'<i class="fas fa-exclamation-triangle"></i> åŠ è½½ç‰ˆæœ¬ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•' +
						'</div>';
					throw error; // é‡æ–°æŠ›å‡ºé”™è¯¯
				}
			}

			/**
			 * ä»APIè·å–æœ€å¤§çš„orderå€¼
			 */
			async function getMaxOrderValue() {
				try {
					const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';
					const response = await fetch(`${apiBaseUrl}/changelog?limit=100`);
					const result = await response.json();

					if (result.success && result.data.changelogs) {
						const changelogs = result.data.changelogs;
						let maxOrder = 0;

						changelogs.forEach(item => {
							if (typeof item.order === 'number' && item.order > maxOrder) {
								maxOrder = item.order;
							}
						});

						return maxOrder;
					}
					return 0;
				} catch (error) {
					console.error('è·å–æœ€å¤§orderå€¼å¤±è´¥:', error);
					return 0;
				}
			}

			/**
			 * ä»APIè·å–timelineæ•°æ®
			 */
			async function loadTimelineData(type) {
				try {
					const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';
					const timestamp = new Date().getTime();
					let url = `${apiBaseUrl}/timeline-data/${type}?timestamp=${timestamp}`;

					const isDev = await isDeveloper();
					if (isDev) {
						url += '&allUsers=true';
						console.log(`[${new Date().toISOString()}] å¼€å‘è€…ç”¨æˆ·ï¼Œè·å–æ‰€æœ‰ç”¨æˆ·çš„${type}æ•°æ®`);
					}

					console.log(`[${new Date().toISOString()}] æ­£åœ¨åŠ è½½${type}æ•°æ®ï¼ŒAPIåœ°å€: ${url}`);
					const token = localStorage.getItem('token') || sessionStorage.getItem('token');
					console.log(`[${new Date().toISOString()}] è·å–åˆ°çš„token:`, token ? `å­˜åœ¨ (${token.length}å­—ç¬¦)` : 'ä¸å­˜åœ¨');

					let currentUserId = null;
					try {
						if (token) {
							const base64Url = token.split('.')[1];
							const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
							const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
							const userInfo = JSON.parse(jsonPayload);
							currentUserId = userInfo.userId || userInfo.id || null;
							console.log(`[${new Date().toISOString()}] å½“å‰ç”¨æˆ·ID:`, currentUserId);
						}
					} catch (e) {
						console.error(`[${new Date().toISOString()}] è§£ætokenå¤±è´¥:`, e);
					}

					const headers = { 'Authorization': token ? `Bearer ${token}` : '' };
					const response = await fetch(url, { headers });
					const result = await response.json();

					if (result.success) {
						const payload = result.data;
						if (isDev && Array.isArray(payload) && payload.length && typeof payload[0] === 'object' && 'userId' in payload[0] && 'data' in payload[0]) {
							const mine = currentUserId ? payload.find(x => x.userId === currentUserId) : null;
							if (mine && Array.isArray(mine.data) && mine.data.length) {
								return { items: mine.data, statusText: '' };
							}
							const merged = [];
							payload.forEach(block => {
								const list = Array.isArray(block.data) ? block.data : [];
								list.forEach(item => {
									const cloned = { ...item };
									if (cloned && typeof cloned === 'object') {
										cloned.title = (cloned.title ? `[${block.userId}] ` + cloned.title : `[${block.userId}]`);
									}
									merged.push(cloned);
								});
							});
							const text = merged.length ? 'æ˜¾ç¤ºæ±‡æ€»æ•°æ®ï¼ˆæœªæ‰¾åˆ°æœ¬äººæ•°æ®ï¼‰' : 'æš‚æ— æ•°æ®ï¼ˆæœªæ‰¾åˆ°ä»»ä½•ç”¨æˆ·æ•°æ®ï¼‰';
							return { items: merged, statusText: text };
						}

						const list = Array.isArray(payload) ? payload : [];
						const text = list.length ? '' : 'æš‚æ— æ•°æ®ï¼ˆæ‚¨è¿˜æ²¡æœ‰åˆ›å»ºè®°å½•ï¼‰';
						return { items: list, statusText: text };
					} else {
						console.error(`[${new Date().toISOString()}] ${type} APIè¿”å›å¤±è´¥:`, result);
						throw new Error(`è·å–${type}æ•°æ®å¤±è´¥: ${JSON.stringify(result)}`);
					}
				} catch (error) {
					console.error(`[${new Date().toISOString()}] åŠ è½½${type}æ•°æ®å¤±è´¥:`, error);
					return { items: [], statusText: 'åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•' };
				}
			}

			/**
			 * å®‰å…¨çš„å†…å®¹è§£æå‡½æ•°
			 * @param {string} content - åŸå§‹å†…å®¹
			 * @returns {object} åŒ…å«è§£æåå†…å®¹å’Œç±»å‹ä¿¡æ¯çš„å¯¹è±¡
			 */
			function parseContent(content) {
				if (!content || typeof content !== 'string') {
					return {
						parsedContent: content || '',
						contentType: 'plain',
						indicator: ''
					};
				}

				const trimmedContent = content.trim();

				// æ£€æµ‹å†…å®¹ç±»å‹
				let contentType = 'plain';
				let indicator = '';

				// æ£€æµ‹ Markdown
				const markdownPatterns = [
					/^#{1,6}\s/, // æ ‡é¢˜
					/\*\*.*?\*\*/, // ç²—ä½“
					/\*.*?\*/, // æ–œä½“
					/\[.*?\]\(.*?\)/, // é“¾æ¥
					/!\[.*?\]\(.*?\)/, // å›¾ç‰‡
					/^[-*+]\s/, // æ— åºåˆ—è¡¨
					/^\d+\.\s/, // æœ‰åºåˆ—è¡¨
					/^>\s/, // å¼•ç”¨
					/`.*?`/, // è¡Œå†…ä»£ç 
					/^```[\s\S]*?```$/m, // ä»£ç å—
					/^\|.*\|$/, // è¡¨æ ¼
					/^---$/, // åˆ†å‰²çº¿
				];

				// æ£€æµ‹ HTML
				const htmlPatterns = [
					/<[^>]+>/, // HTML æ ‡ç­¾
					/&[a-zA-Z]+;/, // HTML å®ä½“
					/&#\d+;/, // æ•°å­— HTML å®ä½“
				];

				const hasMarkdown = markdownPatterns.some(pattern => pattern.test(trimmedContent));
				const hasHtml = htmlPatterns.some(pattern => pattern.test(trimmedContent));

				if (hasMarkdown && hasHtml) {
					contentType = 'markdown+html';
					indicator = ' (Markdown+HTML)';
				} else if (hasMarkdown) {
					contentType = 'markdown';
					indicator = ' (Markdown)';
				} else if (hasHtml) {
					contentType = 'html';
					indicator = ' (HTML)';
				}

				// è§£æå†…å®¹
				let parsedContent = trimmedContent;

				try {
					if (contentType === 'markdown' || contentType === 'markdown+html') {
						// é…ç½® Markdown è§£æå™¨
						marked.setOptions({
							breaks: true, // æ”¯æŒæ¢è¡Œ
							gfm: true, // GitHub Flavored Markdown
							sanitize: false, // ä¸ä½¿ç”¨å†…ç½®çš„ sanitizeï¼Œæˆ‘ä»¬ä½¿ç”¨ DOMPurify
						});

						// è§£æ Markdown
						const htmlContent = marked.parse(trimmedContent);

						// ä½¿ç”¨ DOMPurify æ¸…ç† HTML
						const cleanHtml = DOMPurify.sanitize(htmlContent, {
							ALLOWED_TAGS: [
								'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
								'p', 'br', 'hr',
								'ul', 'ol', 'li',
								'strong', 'b', 'em', 'i',
								'code', 'pre',
								'a', 'img',
								'blockquote',
								'table', 'thead', 'tbody', 'tr', 'th', 'td',
								'span', 'div'
							],
							ALLOWED_ATTR: [
								'href', 'src', 'alt', 'title', 'class', 'id',
								'target', 'rel', 'width', 'height'
							],
							ALLOW_DATA_ATTR: false,
							FORBID_TAGS: ['script', 'style', 'iframe', 'object', 'embed'],
							FORBID_ATTR: ['onerror', 'onload', 'onclick', 'onmouseover', 'onfocus', 'onblur']
						});

						parsedContent = cleanHtml;
					} else if (contentType === 'html') {
						// ç›´æ¥æ¸…ç† HTML
						const cleanHtml = DOMPurify.sanitize(trimmedContent, {
							ALLOWED_TAGS: [
								'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
								'p', 'br', 'hr',
								'ul', 'ol', 'li',
								'strong', 'b', 'em', 'i',
								'code', 'pre',
								'a', 'img',
								'blockquote',
								'table', 'thead', 'tbody', 'tr', 'th', 'td',
								'span', 'div'
							],
							ALLOWED_ATTR: [
								'href', 'src', 'alt', 'title', 'class', 'id',
								'target', 'rel', 'width', 'height'
							],
							ALLOW_DATA_ATTR: false,
							FORBID_TAGS: ['script', 'style', 'iframe', 'object', 'embed'],
							FORBID_ATTR: ['onerror', 'onload', 'onclick', 'onmouseover', 'onfocus', 'onblur']
						});

						parsedContent = cleanHtml;
					}
				} catch (error) {
					console.warn('å†…å®¹è§£æå¤±è´¥ï¼Œä½¿ç”¨åŸå§‹å†…å®¹:', error);
					parsedContent = trimmedContent;
					contentType = 'plain';
					indicator = ' (è§£æå¤±è´¥)';
				}

				return {
					parsedContent,
					contentType,
					indicator
				};
			}

			/**
			 * é€šç”¨çš„æ—¶é—´è½´æ¸²æŸ“å‡½æ•°
			 */
			function renderTimeline(containerId, data, options = {}) {
				const container = document.getElementById(containerId);
				if (!container) return;

				const {
					iconText = 'â˜†',
					titleField = 'title',
					timeField = 'time',
					contentField = 'content',
					imagesField = 'images',
					videosField = 'videos',
					isVersionLog = false,
					versionLogs = null,
					statusText = ''
				} = options;

				const items = Array.isArray(data) ? data : [];
				container.innerHTML = '';
				if (items.length === 0) {
					const text = statusText || 'æš‚æ— æ•°æ®';
					container.innerHTML = `<div class="timeline-empty">${text}</div>`;
					return;
				}

				items.forEach((item, index) => {
					const timelineItem = document.createElement('div');
					timelineItem.className = 'item';
					item.id && (timelineItem.id = item.id);

					// åˆ›å»ºå·¦ä¾§å›¾æ ‡å®¹å™¨
					const leftDiv = document.createElement('div');
					leftDiv.className = 'left';

					const icon = document.createElement('icon');
					icon.className = 'icon';

					// æ ¹æ®ä¸åŒç±»å‹è®¾ç½®å›¾æ ‡
					if (isVersionLog) {
						const isLastAndExpectNext = index === items.length - 1 && item.version === 'ExpectTheNextVersion';
						icon.textContent = isLastAndExpectNext ? 'ğ•¹' : 'ğ•¶';
					} else {
						icon.textContent = iconText;
					}

					leftDiv.appendChild(icon);

					// åˆ›å»ºå³ä¾§å†…å®¹å®¹å™¨
					const rightDiv = document.createElement('div');
					rightDiv.className = 'right';

					// åˆ›å»ºæ ‡é¢˜
					const h4 = document.createElement('h4');
					h4.textContent = item[titleField];

					const timeSpan = document.createElement('span');
					timeSpan.className = 'itemTime';
					const originalTime = item[timeField] || '';
					// ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„æ—¶é—´ï¼Œä¸åœ¨æ¸²æŸ“æ—¶å¤„ç†
					timeSpan.textContent = originalTime;
					h4.appendChild(timeSpan);
					rightDiv.appendChild(h4);

					// åˆ›å»ºå†…å®¹å®¹å™¨
					const contentDiv = document.createElement('div');
					contentDiv.className = 'content';

					if (isVersionLog) {
						// ç‰ˆæœ¬æ—¥å¿—ä½¿ç”¨æœ‰åºåˆ—è¡¨
						const ol = document.createElement('ol');

						const contents = Array.isArray(item[contentField]) ? item[contentField] : [];
						contents.forEach((content, index) => {
							const li = document.createElement('li');
							li.style.position = 'relative'; // ä¸ºç¼–è¾‘æŒ‰é’®å®šä½

							const strong = document.createElement('strong');
							strong.className = 'Ttime';
							const itemTime = content.itemTime || '';
							// ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„æ—¶é—´ï¼Œä¸åœ¨æ¸²æŸ“æ—¶å¤„ç†
							strong.textContent = itemTime;

							li.appendChild(strong);
							li.appendChild(document.createTextNode(' '));

							// è§£æå†…å®¹
							const parsedResult = parseContent(content.itemContent || '');

							const contentSpan = document.createElement('span');

							if (parsedResult.contentType === 'plain') {
								// çº¯æ–‡æœ¬å†…å®¹
								contentSpan.textContent = parsedResult.parsedContent;
								contentSpan.style.whiteSpace = 'pre-wrap';
							} else {
								// HTML å†…å®¹
								contentSpan.innerHTML = parsedResult.parsedContent;
								contentSpan.className = 'parsed-content';
							}

							li.appendChild(contentSpan);

							// æ·»åŠ å†…å®¹ç±»å‹æŒ‡ç¤ºå™¨
							if (parsedResult.indicator) {
								const indicatorSpan = document.createElement('span');
								indicatorSpan.className = 'content-type-indicator';
								indicatorSpan.textContent = parsedResult.indicator;
								li.appendChild(indicatorSpan);
							}

							// ä¸ºæ¯ä¸ªå­æ¡ç›®æ·»åŠ ç¼–è¾‘æŒ‰é’®ï¼ˆé¼ æ ‡æ‚¬åœæ˜¾ç¤ºï¼‰
							if (isUserLoggedIn() && (globalHasEditPermission || globalUserRole === 'developer' || globalUserRole === 'admin')) {
								// ä¸ºliå…ƒç´ æ·»åŠ CSSç±»ï¼Œç”¨äºCSSæ‚¬åœæ•ˆæœ
								li.className = 'changelog-item-with-edit';

								const editItemButton = document.createElement('button');
								editItemButton.textContent = 'âœï¸ ç¼–è¾‘';
								editItemButton.title = 'ç¼–è¾‘æ­¤æ¡ç›®';
								editItemButton.className = 'changelog-edit-button';
								editItemButton.onclick = () => showEditChangelogItemForm(item._id, item.version, index, content);
								li.appendChild(editItemButton);

								const deleteItemButton = document.createElement('button');
								deleteItemButton.textContent = 'ğŸ—‘ï¸ åˆ é™¤';
								deleteItemButton.title = 'åˆ é™¤æ­¤æ¡ç›®';
								deleteItemButton.className = 'changelog-edit-button delete';
								deleteItemButton.onclick = async () => {
									if (!confirm('ç¡®å®šè¦åˆ é™¤æ­¤æ¡ç›®å—ï¼Ÿ')) return;
									try {
										const token = localStorage.getItem('token') || sessionStorage.getItem('token');
										const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';
										const resp = await fetch(`${apiBaseUrl}/changelog/${item._id}/items/${index}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${token}` } });
										let resJson; try { resJson = await resp.json(); } catch (_) { resJson = { success: false, message: `HTTP ${resp.status}` }; }
										if (resJson.success) { await loadAllData(); showSuccessMessage('åˆ é™¤æˆåŠŸ'); } else { alert(`åˆ é™¤å¤±è´¥ (${resp.status}): ${resJson.message || ''}`); }
									} catch (err) { console.error('åˆ é™¤å¤±è´¥:', err); alert('åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'); }
								};
								li.appendChild(deleteItemButton);
							}

							ol.appendChild(li);
						});

						contentDiv.appendChild(ol);
					} else {
						// å…¶ä»–å†…å®¹ç›´æ¥æ˜¾ç¤º
						if (Array.isArray(item[contentField])) {
							item[contentField].forEach(content => {
								let contentText = '';
								if (typeof content === 'string') {
									contentText = content;
								} else if (content && typeof content === 'object') {
									contentText = content.itemContent || content.content || '';
								} else {
									contentText = String(content || '');
								}

								if (contentText.trim() !== '') {
									// è§£æå†…å®¹
									const parsedResult = parseContent(contentText);

									const p = document.createElement('p');

									if (parsedResult.contentType === 'plain') {
										// çº¯æ–‡æœ¬å†…å®¹
										p.textContent = parsedResult.parsedContent;
										p.style.whiteSpace = 'pre-wrap';
									} else {
										// HTML å†…å®¹
										p.innerHTML = parsedResult.parsedContent;
										p.className = 'parsed-content';
									}

									contentDiv.appendChild(p);

									// æ·»åŠ å†…å®¹ç±»å‹æŒ‡ç¤ºå™¨
									if (parsedResult.indicator) {
										const indicatorSpan = document.createElement('span');
										indicatorSpan.className = 'content-type-indicator';
										indicatorSpan.textContent = parsedResult.indicator;
										contentDiv.appendChild(indicatorSpan);
									}
								}
							});
						} else {
							const contentText = String(item[contentField] || '');
							if (contentText.trim() !== '') {
								// è§£æå†…å®¹
								const parsedResult = parseContent(contentText);

								const p2 = document.createElement('p');

								if (parsedResult.contentType === 'plain') {
									// çº¯æ–‡æœ¬å†…å®¹
									p2.textContent = parsedResult.parsedContent;
									p2.style.whiteSpace = 'pre-wrap';
								} else {
									// HTML å†…å®¹
									p2.innerHTML = parsedResult.parsedContent;
									p2.className = 'parsed-content';
								}

								contentDiv.appendChild(p2);

								// æ·»åŠ å†…å®¹ç±»å‹æŒ‡ç¤ºå™¨
								if (parsedResult.indicator) {
									const indicatorSpan = document.createElement('span');
									indicatorSpan.className = 'content-type-indicator';
									indicatorSpan.textContent = parsedResult.indicator;
									contentDiv.appendChild(indicatorSpan);
								}
							}
						}
					}

					rightDiv.appendChild(contentDiv);

					// æ·»åŠ å›¾ç‰‡
					if (item[imagesField] && item[imagesField].length > 0) {
						const imagesDiv = document.createElement('div');
						imagesDiv.className = 'images';

						item[imagesField].forEach(image => {
							const img = document.createElement('img');
							img.src = image;
							img.alt = 'å›¾ç‰‡';
							img.onclick = () => {
								const modal = document.createElement('div');
								modal.className = 'modal-overlay';
								const modalImg = document.createElement('img');
								modalImg.src = img.src;
								modalImg.className = 'modal-image';
								modal.appendChild(modalImg);
								modal.onclick = () => modal.remove();
								document.body.appendChild(modal);
							};
							imagesDiv.appendChild(img);
						});

						contentDiv.appendChild(imagesDiv);
					}

					// æ·»åŠ è§†é¢‘
					if (item[videosField] && item[videosField].length > 0) {
						const videosDiv = document.createElement('div');
						videosDiv.className = 'videos';

						item[videosField].forEach(video => {
							const videoElement = document.createElement('video');
							videoElement.src = video;
							videoElement.controls = true;
							videoElement.preload = 'metadata';
							videosDiv.appendChild(videoElement);
						});

						contentDiv.appendChild(videosDiv);
					}

					// æ·»åŠ ç¼–è¾‘æŒ‰é’®ï¼ˆä½¿ç”¨å…¨å±€æƒé™çŠ¶æ€ï¼‰
					try {
						if (isUserLoggedIn() && canEdit()) {
							// åˆ›å»ºæŒ‰é’®å®¹å™¨
							const actionsDiv = document.createElement('div');
							actionsDiv.className = 'timeline-actions';
							actionsDiv.style.display = 'flex'; // ç›´æ¥æ˜¾ç¤º

							// å¦‚æœæ˜¯ç‰ˆæœ¬æ—¥å¿—ï¼Œæ·»åŠ "æ·»åŠ æ¡ç›®"æŒ‰é’®
							if (isVersionLog) {
								const addItemButton = document.createElement('button');
								addItemButton.textContent = 'â• æ·»åŠ æ¡ç›®';
								addItemButton.style.background = '#27ae60';
								addItemButton.style.marginRight = '10px';
								addItemButton.onclick = () => showAddChangelogItemForm(item._id, item.version);
								actionsDiv.appendChild(addItemButton);
							}

							const editButton = document.createElement('button');
							editButton.textContent = 'ç¼–è¾‘';
							editButton.onclick = () => editTimelineItem(item, containerId);

							const deleteButton = document.createElement('button');
							deleteButton.textContent = 'åˆ é™¤';
							deleteButton.onclick = () => deleteTimelineItem(item, containerId);

							actionsDiv.appendChild(editButton);
							actionsDiv.appendChild(deleteButton);
							rightDiv.appendChild(actionsDiv);

							// ç®¡ç†å‘˜åªèƒ½çœ‹åˆ°ç¼–è¾‘æŒ‰é’®å’Œæ·»åŠ æ¡ç›®æŒ‰é’®
							if (globalUserRole === 'admin') {
								deleteButton.style.display = 'none';
							}
						}
					} catch (error) {
						console.error('æ·»åŠ ç¼–è¾‘æŒ‰é’®å¤±è´¥:', error);
					}

					// ç»„è£…æ—¶é—´è½´é¡¹
					timelineItem.appendChild(leftDiv);
					timelineItem.appendChild(rightDiv);

					// æ·»åŠ åˆ°å®¹å™¨
					container.appendChild(timelineItem);
				});

				// ç‰ˆæœ¬æ—¥å¿—ç‰¹æ®Šå¤„ç†
				if (isVersionLog && versionLogs && versionLogs.length > 0) {
					const lastIndex = versionLogs.length - 1;
					if (versionLogs[lastIndex].version === 'ExpectTheNextVersion') {
						const lastTimelineItem = container.lastElementChild;
						if (lastTimelineItem) {
							lastTimelineItem.style.opacity = '0.7';
							lastTimelineItem.style.fontStyle = 'italic';
						}
					}

					// ä¸ºExpectTheNextVersionè®¾ç½®IDä¸ºExpectTheNextVersion
					// ä¸ºorderæ•°å­—ç±»å‹æœ€å¤§çš„å…ƒç´ è®¾ç½®IDä¸ºlastUpdate
					if (isVersionLog && data && data.length > 0) {
						const timelineItems = container.querySelectorAll('.item');

						// æ‰¾åˆ°orderæ•°å­—ç±»å‹æœ€å¤§çš„å…ƒç´ 
						let maxOrderItem = null;
						let maxOrder = -Infinity;

						data.forEach((item, index) => {
							// æ£€æŸ¥æ˜¯å¦ä¸ºExpectTheNextVersion
							if (item.version === 'ExpectTheNextVersion') {
								timelineItems[index].id = 'ExpectTheNextVersion';
							}
							// æ£€æŸ¥orderæ˜¯å¦ä¸ºæ•°å­—ç±»å‹ä¸”æœ€å¤§
							else if (typeof item.order === 'number') {
								if (item.order > maxOrder) {
									maxOrder = item.order;
									maxOrderItem = { item, index };
								}
							}
						});

						// å¦‚æœæ‰¾åˆ°äº†orderæœ€å¤§çš„å…ƒç´ ï¼Œè®¾ç½®å…¶IDä¸ºlastUpdate
						if (maxOrderItem) {
							timelineItems[maxOrderItem.index].id = 'lastUpdate';
						}
					}
				}
			}



			// å…¨å±€ç”¨æˆ·æƒé™çŠ¶æ€
			let globalUserRole = 'guest';
			let globalHasEditPermission = false;
			let globalHasDeletePermission = false;

			// é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
			document.addEventListener('DOMContentLoaded', async function () {
				console.log('é¡µé¢åŠ è½½å®Œæˆ');

				// ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥ç™»å½•çŠ¶æ€å’Œtoken
				console.log('=== é¡µé¢åŠ è½½æ—¶tokenæ£€æŸ¥ ===');
				const localToken = localStorage.getItem('token');
				const sessionToken = sessionStorage.getItem('token');
				const token = localToken || sessionToken;
				console.log('localStorage token:', localToken ? `å­˜åœ¨ (${localToken.length}å­—ç¬¦)` : 'ä¸å­˜åœ¨');
				console.log('sessionStorage token:', sessionToken ? `å­˜åœ¨ (${sessionToken.length}å­—ç¬¦)` : 'ä¸å­˜åœ¨');
				console.log('æœ€ç»ˆä½¿ç”¨token:', token ? `å­˜åœ¨ (${token.length}å­—ç¬¦)` : 'ä¸å­˜åœ¨');

				// æ¸…é™¤ç¼“å­˜ï¼Œç¡®ä¿è·å–æœ€æ–°çš„ç™»å½•çŠ¶æ€
				clearAllCache();

				// ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥ç”¨æˆ·æƒé™
				globalUserRole = await getUserRole();
				globalHasEditPermission = await hasEditPermission();
				globalHasDeletePermission = await hasDeletePermission();
				console.log('ç”¨æˆ·è§’è‰²:', globalUserRole, 'ç¼–è¾‘æƒé™:', globalHasEditPermission, 'åˆ é™¤æƒé™:', globalHasDeletePermission);

				// ç¬¬ä¸‰æ­¥ï¼šæ˜¾ç¤º/éšè—ç®¡ç†æŒ‰é’®
				if (canEdit()) {
					document.getElementById('addMyPastBtn').style.display = 'inline-block';
					document.getElementById('addHealthBtn').style.display = 'inline-block';
					document.getElementById('addChangelogBtn').style.display = 'inline-block';
					console.log('æ˜¾ç¤ºç®¡ç†æŒ‰é’® - ç”¨æˆ·è§’è‰²:', globalUserRole);

					// æ·»åŠ æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
					document.getElementById('addMyPastBtn').onclick = () => showAddForm('myPastData');
					document.getElementById('addHealthBtn').onclick = () => showAddForm('healthData');
					document.getElementById('addChangelogBtn').onclick = () => showAddChangelogForm();
				} else {
					console.log('éšè—ç®¡ç†æŒ‰é’® - ç”¨æˆ·è§’è‰²:', globalUserRole);
				}

				// ç¬¬ä¸‰æ­¥ï¼šåŠ è½½æ‰€æœ‰æ•°æ®
				await loadAllData();

				// ç¬¬å››æ­¥ï¼šå¤„ç†é”šç‚¹è·³è½¬
				handleAnchorNavigation();

				// ç¬¬äº”æ­¥ï¼šæ·»åŠ é˜²é‡å¤ç‚¹å‡»æœºåˆ¶çš„æ›´æ–°æ—¥å¿—
				addChangelogEntry();

				// ç›‘å¬URLå˜åŒ–ï¼Œå¤„ç†é”šç‚¹è·³è½¬
				window.addEventListener('hashchange', function () {
					console.log('URLé”šç‚¹å˜åŒ–ï¼Œé‡æ–°å¤„ç†è·³è½¬');
					handleAnchorNavigation();
				});
			});

			// åŠ è½½æ‰€æœ‰æ•°æ®çš„å‡½æ•°
			async function loadAllData() {
				try {
					// å¹¶è¡ŒåŠ è½½æ‰€æœ‰æ•°æ®
					const [changelogPromise, myPastPromise, healthPromise] = await Promise.allSettled([
						loadChangelogFromAPI(),
						loadTimelineData('myPast'),
						loadTimelineData('health')
					]);

					// å¤„ç†changelogæ•°æ®
					if (changelogPromise.status === 'fulfilled') {
						console.log('Changelogæ•°æ®åŠ è½½å®Œæˆ');
						// åœ¨æƒé™æ£€æŸ¥ä¹‹åæ¸²æŸ“changelog
						renderTimeline('versionLogContainer', changelogPromise.value, {
							isVersionLog: true,
							versionLogs: changelogPromise.value,
							titleField: 'version',
							timeField: 'time',
							contentField: 'content'
						});
					} else {
						console.error('Changelogæ•°æ®åŠ è½½å¤±è´¥:', changelogPromise.reason);
					}

					// å¤„ç†My Pastæ•°æ®
					if (myPastPromise.status === 'fulfilled') {
						const mp = myPastPromise.value || { items: [], statusText: '' };
						const list = Array.isArray(mp.items) ? mp.items : [];
						console.log('My Pastæ•°æ®:', list);
						renderTimeline('myPastContainer', list, {
							iconText: 'ğŸ“…', titleField: 'title', timeField: 'time', contentField: 'content', imagesField: 'images', videosField: 'videos',
							statusText: mp.statusText
						});
					}

					// å¤„ç†Healthæ•°æ®
					if (healthPromise.status === 'fulfilled') {
						const hp = healthPromise.value || { items: [], statusText: '' };
						const list = Array.isArray(hp.items) ? hp.items : [];
						console.log('Healthæ•°æ®:', list);
						renderTimeline('healthContainer', list, {
							iconText: 'ğŸ¥', titleField: 'title', timeField: 'time', contentField: 'content', imagesField: 'images', videosField: 'videos',
							statusText: hp.statusText
						});
					}

					console.log('æ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆ');
				} catch (error) {
					console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
				}
			}

			// å¤„ç†é”šç‚¹è·³è½¬çš„å‡½æ•°
			function handleAnchorNavigation() {
				// è·å–URLä¸­çš„é”šç‚¹
				const hash = window.location.hash;
				if (hash) {
					// console.log('æ£€æµ‹åˆ°é”šç‚¹:', hash);

					// å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿DOMå®Œå…¨æ¸²æŸ“
					setTimeout(() => {
						const targetElement = document.querySelector(hash);
						if (targetElement) {
							// console.log('æ‰¾åˆ°ç›®æ ‡å…ƒç´ ï¼Œæ‰§è¡Œè·³è½¬:', targetElement);
							targetElement.scrollIntoView({
								behavior: 'smooth',
								block: 'start'
							});

							// æ·»åŠ é«˜äº®æ•ˆæœ
							targetElement.style.transition = 'background-color 0.3s ease';
							targetElement.style.backgroundColor = 'rgba(22, 160, 133, 0.2)';
							setTimeout(() => {
								targetElement.style.backgroundColor = '';
							}, 2000);
						} else {
							console.log('æœªæ‰¾åˆ°ç›®æ ‡å…ƒç´ :', hash);
						}
					}, 500); // ç­‰å¾…500msç¡®ä¿DOMæ¸²æŸ“å®Œæˆ
				}
			}

			// æ·»åŠ æ›´æ–°æ—¥å¿—æ¡ç›®çš„å‡½æ•°
			async function addChangelogEntry() {
				try {
					// æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ è¿‡è¿™ä¸ªæ¡ç›®ï¼ˆé¿å…é‡å¤æ·»åŠ ï¼‰
					const existingEntry = localStorage.getItem('changelog_antiduplicate_added');
					if (existingEntry) {
						// console.log('æ›´æ–°æ—¥å¿—æ¡ç›®å·²å­˜åœ¨ï¼Œè·³è¿‡æ·»åŠ ');
						return;
					}

					const token = localStorage.getItem('token') || sessionStorage.getItem('token');
					if (!token) {
						console.log('æœªæ‰¾åˆ°tokenï¼Œè·³è¿‡æ·»åŠ æ›´æ–°æ—¥å¿—');
						return; // å¦‚æœæ²¡æœ‰tokenï¼Œä¸æ·»åŠ æ¡ç›®
					}

					// æ£€æŸ¥ç”¨æˆ·æƒé™ï¼Œåªæœ‰å¼€å‘è€…æ‰è‡ªåŠ¨æ·»åŠ 
					if (globalUserRole !== 'developer') {
						console.log('ç”¨æˆ·ä¸æ˜¯å¼€å‘è€…ï¼Œè·³è¿‡è‡ªåŠ¨æ·»åŠ æ›´æ–°æ—¥å¿—');
						localStorage.setItem('changelog_antiduplicate_added', 'true');
						return;
					}

					const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';

					// è·å–æœ€æ–°çš„ç‰ˆæœ¬IDï¼ˆExpectTheNextVersionï¼‰
					const response = await fetch(`${apiBaseUrl}/changelog?limit=100`);
					const result = await response.json();

					if (result.success && result.data.changelogs) {
						const changelogs = result.data.changelogs;
						const expectNextVersion = changelogs.find(item => item.version === 'ExpectTheNextVersion');

						if (expectNextVersion) {
							const newEntry = {
								itemTime: '2025-01-17 19:58:52',
								itemContent: 'æ·»åŠ é˜²é‡å¤ç‚¹å‡»æœºåˆ¶ï¼šä¸ºæ‰€æœ‰ç½‘ç»œè¯·æ±‚æ“ä½œï¼ˆæ·»åŠ ç‰ˆæœ¬ã€æäº¤æ¡ç›®ã€ç¼–è¾‘ç­‰ï¼‰æ·»åŠ æŒ‰é’®ç¦ç”¨çŠ¶æ€ç®¡ç†ï¼Œé˜²æ­¢ç”¨æˆ·åœ¨ç½‘ç»œè¯·æ±‚æ…¢çš„æƒ…å†µä¸‹å¤šæ¬¡ç‚¹å‡»ï¼Œæå‡ç”¨æˆ·ä½“éªŒå¹¶å‡å°‘æœåŠ¡å™¨å‹åŠ›ã€‚'
							};

							// è°ƒè¯•ä¿¡æ¯
							console.log('è‡ªåŠ¨æ·»åŠ æ›´æ–°æ—¥å¿— - è¯·æ±‚æ•°æ®:', {
								versionId: expectNextVersion._id,
								itemContent: newEntry.itemContent,
								itemTime: newEntry.itemTime,
								token: token ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'
							});

							// ä½¿ç”¨ä¸æ‰‹åŠ¨æ·»åŠ æ¡ç›®å®Œå…¨ç›¸åŒçš„è¯·æ±‚æ ¼å¼
							const requestData = {
								itemContent: newEntry.itemContent
							};

							// æ£€æŸ¥æ˜¯å¦ä¸ºå¼€å‘è€…ä¸”é€‰æ‹©æ‰‹åŠ¨è®¾ç½®æ—¶é—´
							const isDeveloper = globalUserRole === 'developer';
							if (isDeveloper) {
								// å¼€å‘è€…å¯ä»¥é€‰æ‹©æ‰‹åŠ¨è®¾ç½®æ—¶é—´
								requestData.itemTime = newEntry.itemTime;
								requestData.useAutoTime = false;
							} else {
								// éå¼€å‘è€…åªèƒ½ä½¿ç”¨è‡ªåŠ¨æ—¶é—´
								requestData.useAutoTime = true;
							}

							console.log('æœ€ç»ˆè¯·æ±‚æ•°æ®:', requestData);

							const addResponse = await fetch(`${apiBaseUrl}/changelog/${expectNextVersion._id}/items`, {
								method: 'POST',
								headers: {
									'Authorization': `Bearer ${token}`,
									'Content-Type': 'application/json'
								},
								body: JSON.stringify(requestData)
							});

							// è°ƒè¯•å“åº”ä¿¡æ¯
							console.log('è‡ªåŠ¨æ·»åŠ æ›´æ–°æ—¥å¿— - æœåŠ¡å™¨å“åº”:', {
								status: addResponse.status,
								statusText: addResponse.statusText,
								ok: addResponse.ok
							});

							if (!addResponse.ok) {
								const errorText = await addResponse.text();
								console.error('è‡ªåŠ¨æ·»åŠ æ›´æ–°æ—¥å¿—å¤±è´¥:', errorText);
							}

							if (addResponse.ok) {
								// æ ‡è®°å·²æ·»åŠ ï¼Œé¿å…é‡å¤æ·»åŠ 
								localStorage.setItem('changelog_antiduplicate_added', 'true');
								console.log('é˜²é‡å¤ç‚¹å‡»æœºåˆ¶æ›´æ–°æ—¥å¿—å·²æ·»åŠ ');
							} else {
								// å³ä½¿å¤±è´¥ä¹Ÿæ ‡è®°ä¸ºå·²æ·»åŠ ï¼Œé¿å…é‡å¤å°è¯•
								localStorage.setItem('changelog_antiduplicate_added', 'true');
								console.log('é˜²é‡å¤ç‚¹å‡»æœºåˆ¶æ›´æ–°æ—¥å¿—æ·»åŠ å¤±è´¥ï¼Œä½†å·²æ ‡è®°ä¸ºå·²æ·»åŠ ');

								// åœ¨æ§åˆ¶å°æä¾›æ‰‹åŠ¨æ·»åŠ çš„æç¤º
								console.log('å¦‚éœ€æ‰‹åŠ¨æ·»åŠ æ­¤æ¡ç›®ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å†…å®¹ï¼š');
								console.log('æ—¶é—´:', newEntry.itemTime);
								console.log('å†…å®¹:', newEntry.itemContent);
							}
						}
					}
				} catch (error) {
					console.error('æ·»åŠ æ›´æ–°æ—¥å¿—æ¡ç›®å¤±è´¥:', error);
					// å³ä½¿å¤±è´¥ä¹Ÿæ ‡è®°ä¸ºå·²æ·»åŠ ï¼Œé¿å…é‡å¤å°è¯•
					localStorage.setItem('changelog_antiduplicate_added', 'true');
					console.log('ç”±äºé”™è¯¯ï¼Œå·²æ ‡è®°æ›´æ–°æ—¥å¿—ä¸ºå·²æ·»åŠ çŠ¶æ€');
				}
			}

			// æ˜¾ç¤ºåŠ è½½çŠ¶æ€æ¶ˆæ¯
			function showLoadingMessage(message) {
				// ç§»é™¤å·²å­˜åœ¨çš„åŠ è½½æ¶ˆæ¯
				hideLoadingMessage();

				const loadingDiv = document.createElement('div');
				loadingDiv.id = 'loadingMessage';
				loadingDiv.style.cssText = `
					position: fixed;
					top: 50%;
					left: 50%;
					transform: translate(-50%, -50%);
					background: rgba(0, 0, 0, 0.8);
					color: white;
					padding: 20px 30px;
					border-radius: 10px;
					z-index: 10000;
					font-size: 16px;
					text-align: center;
					box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
				`;
				loadingDiv.innerHTML = `
					<div style="margin-bottom: 10px;">
						<span style="animation: spin 1s linear infinite;">â³</span>
					</div>
					<div>${message}</div>
				`;

				// æ·»åŠ æ—‹è½¬åŠ¨ç”»æ ·å¼
				const style = document.createElement('style');
				style.textContent = `
					@keyframes spin {
						from { transform: rotate(0deg); }
						to { transform: rotate(360deg); }
					}
				`;
				document.head.appendChild(style);

				document.body.appendChild(loadingDiv);
			}

			// éšè—åŠ è½½çŠ¶æ€æ¶ˆæ¯
			function hideLoadingMessage() {
				const loadingDiv = document.getElementById('loadingMessage');
				if (loadingDiv) {
					loadingDiv.remove();
				}
			}

			// æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
			function showSuccessMessage(message) {
				// ç§»é™¤å·²å­˜åœ¨çš„æˆåŠŸæ¶ˆæ¯
				const existingSuccess = document.getElementById('successMessage');
				if (existingSuccess) {
					existingSuccess.remove();
				}

				const successDiv = document.createElement('div');
				successDiv.id = 'successMessage';
				successDiv.style.cssText = `
					position: fixed;
					top: 50%;
					left: 50%;
					transform: translate(-50%, -50%);
					background: rgba(40, 167, 69, 0.9);
					color: white;
					padding: 20px 30px;
					border-radius: 10px;
					z-index: 10000;
					font-size: 16px;
					text-align: center;
					box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
					animation: fadeInOut 3s ease-in-out;
				`;
				successDiv.innerHTML = `
					<div style="margin-bottom: 10px; font-size: 24px;">âœ…</div>
					<div>${message}</div>
				`;

				// æ·»åŠ æ·¡å…¥æ·¡å‡ºåŠ¨ç”»æ ·å¼
				const style = document.createElement('style');
				style.textContent = `
					@keyframes fadeInOut {
						0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
						20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
						80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
						100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
					}
				`;
				document.head.appendChild(style);

				document.body.appendChild(successDiv);

				// 3ç§’åè‡ªåŠ¨ç§»é™¤
				setTimeout(() => {
					if (successDiv.parentNode) {
						successDiv.remove();
					}
				}, 3000);
			}

			// ç¼–è¾‘æ—¶é—´è½´é¡¹
			async function editTimelineItem(item, containerId) {
				console.log('ç¼–è¾‘é¡¹ç›®:', item, 'ç”¨æˆ·è§’è‰²:', globalUserRole, 'ç¼–è¾‘æƒé™:', globalHasEditPermission);

				if (canEdit()) {
					// æ ¹æ®å®¹å™¨ç±»å‹ç¡®å®šç¼–è¾‘ç±»å‹
					if (containerId === 'versionLogContainer') {
						showEditChangelogForm(item);
					} else {
						showEditTimelineForm(item, containerId);
					}
				} else {
					alert('æƒé™ä¸è¶³ï¼Œåªæœ‰å¼€å‘è€…å’Œç®¡ç†å‘˜å¯ä»¥ç¼–è¾‘');
				}
			}

			// æ˜¾ç¤ºç¼–è¾‘æ—¶é—´è½´è¡¨å•
			function showEditTimelineForm(item, containerId) {
				const formHtml = `
					<div id="editFormOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; justify-content: center; align-items: center;">
						<div style="background: white; padding: 20px; border-radius: 10px; width: 80%; max-width: 500px; max-height: 80vh; overflow-y: auto;">
							<h3>ç¼–è¾‘æ¡ç›®</h3>
							<form id="editItemForm">
								<input type="hidden" id="editItemId" value="${item._id}">
								<input type="hidden" id="editContainerId" value="${containerId}">
								<div style="margin-bottom: 15px;">
									<label>æ ‡é¢˜:</label><br>
									<input type="text" id="editTitle" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" value="${item.title || ''}">
								</div>
								<div style="margin-bottom: 15px;">
									<label>æ—¶é—´:</label><br>
									<input type="text" id="editTime" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" value="${item.time || ''}" placeholder="æ ¼å¼: YYYY-MM-DD HH:MM:SS">
								</div>
								<div style="margin-bottom: 15px;">
									<label>å†…å®¹: <span style="font-size: 0.8em; color: #666;">(æ”¯æŒ Markdown å’Œ HTML)</span></label><br>
									<textarea id="editContent" required style="width: 100%; height: 100px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="è¯·è¾“å…¥å†…å®¹...æ”¯æŒ Markdown è¯­æ³•å¦‚ **ç²—ä½“**ã€*æ–œä½“*ã€[é“¾æ¥](url) ç­‰"></textarea>
									<div style="margin-top: 5px; font-size: 0.8em; color: #666;">
										<strong>æ”¯æŒæ ¼å¼:</strong> Markdown (**, *, #, >, \`, \`\`\`), HTML æ ‡ç­¾ (å®‰å…¨è¿‡æ»¤)
									</div>
									<button type="button" onclick="previewContent('editContent')" style="margin-top: 5px; padding: 4px 8px; background: #16A085; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 0.8em;">é¢„è§ˆå†…å®¹</button>
								</div>
								<div style="margin-bottom: 15px;">
									<label>å›¾ç‰‡URL (å¯é€‰ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”):</label><br>
									<input type="text" id="editImages" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" value="${item.images ? item.images.join(', ') : ''}" placeholder="ä¾‹å¦‚: /images/photo1.jpg, /images/photo2.jpg">
								</div>
								<div style="margin-bottom: 15px;">
									<label>è§†é¢‘URL (å¯é€‰ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”):</label><br>
									<input type="text" id="editVideos" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" value="${item.videos ? item.videos.join(', ') : ''}" placeholder="ä¾‹å¦‚: /videos/video1.mp4, /videos/video2.mp4">
								</div>
								<div style="text-align: right;">
									<button type="button" onclick="closeEditForm()" style="background: #95a5a6; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px;">å–æ¶ˆ</button>
									<button type="submit" style="background: #16A085; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">ä¿å­˜</button>
								</div>
							</form>
						</div>
					</div>
				`;

				document.body.insertAdjacentHTML('beforeend', formHtml);

				// æ·»åŠ ESCé”®å…³é—­åŠŸèƒ½
				const overlay = document.getElementById('editFormOverlay');
				overlay.addEventListener('keydown', function (e) {
					if (e.key === 'Escape') {
						closeEditForm();
					}
				});

				// æ·»åŠ è¡¨å•æäº¤äº‹ä»¶
				document.getElementById('editItemForm').onsubmit = (e) => {
					e.preventDefault();
					submitEditTimeline();
				};

				// è®¾ç½®textareaçš„å€¼
				const textarea = document.getElementById('editContent');
				if (textarea) {
					textarea.value = item.content && item.content[0] ? item.content[0].itemContent : '';
				}
			}

			// æ˜¾ç¤ºç¼–è¾‘ç‰ˆæœ¬è¡¨å•
			function showEditChangelogForm(item) {
				const formHtml = `
					<div id="editChangelogFormOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; justify-content: center; align-items: center;">
						<div style="background: white; padding: 20px; border-radius: 10px; width: 80%; max-width: 500px; max-height: 80vh; overflow-y: auto;">
							<h3>ç¼–è¾‘ç‰ˆæœ¬</h3>
							<form id="editChangelogForm">
								<input type="hidden" id="editChangelogId" value="${item._id}">
								<div style="margin-bottom: 15px;">
									<label>ç‰ˆæœ¬å·:</label><br>
									<input type="text" id="editVersion" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" value="${item.version || ''}" placeholder="ä¾‹å¦‚: v5.0.5">
								</div>
								<div style="margin-bottom: 15px;">
									<label>æ—¶é—´:</label><br>
									<input type="text" id="editChangelogTime" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" value="${item.time || ''}" placeholder="æ ¼å¼: YYYY-MM-DD HH:MM:SS">
								</div>
								<div style="text-align: right;">
									<button type="button" onclick="closeEditChangelogForm()" style="background: #95a5a6; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px;">å–æ¶ˆ</button>
									<button type="submit" style="background: #16A085; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">ä¿å­˜</button>
								</div>
							</form>
						</div>
					</div>
				`;

				document.body.insertAdjacentHTML('beforeend', formHtml);

				// æ·»åŠ ESCé”®å…³é—­åŠŸèƒ½
				const overlay = document.getElementById('editChangelogFormOverlay');
				overlay.addEventListener('keydown', function (e) {
					if (e.key === 'Escape') {
						closeEditChangelogForm();
					}
				});

				// æ·»åŠ è¡¨å•æäº¤äº‹ä»¶
				document.getElementById('editChangelogForm').onsubmit = (e) => {
					e.preventDefault();
					submitEditChangelog();
				};
			}

			// å…³é—­ç¼–è¾‘è¡¨å•
			function closeEditForm() {
				const overlay = document.getElementById('editFormOverlay');
				if (overlay) {
					overlay.remove();
				}
			}

			// å…³é—­ç¼–è¾‘ç‰ˆæœ¬è¡¨å•
			function closeEditChangelogForm() {
				const overlay = document.getElementById('editChangelogFormOverlay');
				if (overlay) {
					overlay.remove();
				}
			}

			// æ˜¾ç¤ºç¼–è¾‘å­æ¡ç›®è¡¨å•
			function showEditChangelogItemForm(changelogId, version, itemIndex, content) {
				const formHtml = `
					<div id="editChangelogItemFormOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; justify-content: center; align-items: center;">
						<div style="background: white; padding: 20px; border-radius: 10px; width: 80%; max-width: 500px; max-height: 80vh; overflow-y: auto;">
							<h3>ç¼–è¾‘å­æ¡ç›® - ${version}</h3>
							<form id="editChangelogItemForm">
								<input type="hidden" id="editChangelogItemId" value="${changelogId}">
								<input type="hidden" id="editChangelogItemIndex" value="${itemIndex}">
								<div style="margin-bottom: 15px;">
									<label>æ—¶é—´è®¾ç½®:</label><br>
									<select id="editItemTimeSetting" onchange="toggleEditItemTimeInput()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
										<option value="auto" selected>è‡ªåŠ¨è®¾ç½®æ—¶é—´ï¼ˆUTC+8ï¼‰</option>
										<option value="manual">æ‰‹åŠ¨è®¾ç½®æ—¶é—´</option>
									</select>
									<input type="datetime-local" id="editItemManualTimeInput" step="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; display: none;" placeholder="é€‰æ‹©æ—¶é—´">
								</div>
								<div style="margin-bottom: 15px;">
									<label>å†…å®¹: <span style="font-size: 0.8em; color: #666;">(æ”¯æŒ Markdown å’Œ HTML)</span></label><br>
									<textarea id="editChangelogItemContent" required style="width: 100%; height: 100px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="è¯·è¾“å…¥å†…å®¹...æ”¯æŒ Markdown è¯­æ³•å¦‚ **ç²—ä½“**ã€*æ–œä½“*ã€[é“¾æ¥](url) ç­‰">${content.itemContent || ''}</textarea>
									<div style="margin-top: 5px; font-size: 0.8em; color: #666;">
										<strong>æ”¯æŒæ ¼å¼:</strong> Markdown (**, *, #, >, \`, \`\`\`), HTML æ ‡ç­¾ (å®‰å…¨è¿‡æ»¤)
									</div>
									<button type="button" onclick="previewContent('editChangelogItemContent')" style="margin-top: 5px; padding: 4px 8px; background: #16A085; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 0.8em;">é¢„è§ˆå†…å®¹</button>
								</div>
								<div style="text-align: right;">
									<button type="button" onclick="closeEditChangelogItemForm()" style="background: #95a5a6; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px;">å–æ¶ˆ</button>
									<button type="submit" style="background: #16A085; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">ä¿å­˜</button>
								</div>
							</form>
						</div>
					</div>
				`;

				document.body.insertAdjacentHTML('beforeend', formHtml);

				// æ·»åŠ ESCé”®å…³é—­åŠŸèƒ½
				const overlay = document.getElementById('editChangelogItemFormOverlay');
				overlay.addEventListener('keydown', function (e) {
					if (e.key === 'Escape') {
						closeEditChangelogItemForm();
					}
				});

				// æ·»åŠ è¡¨å•æäº¤äº‹ä»¶
				document.getElementById('editChangelogItemForm').onsubmit = (e) => {
					e.preventDefault();
					submitEditChangelogItem();
				};
			}

			// å…³é—­ç¼–è¾‘å­æ¡ç›®è¡¨å•
			function closeEditChangelogItemForm() {
				const overlay = document.getElementById('editChangelogItemFormOverlay');
				if (overlay) {
					overlay.remove();
				}
			}

			// æäº¤ç¼–è¾‘æ—¶é—´è½´
			async function submitEditTimeline() {
				// é˜²æ­¢é‡å¤æäº¤
				const submitBtn = document.querySelector('#editItemForm button[type="submit"]');
				if (submitBtn) {
					submitBtn.disabled = true;
					submitBtn.textContent = 'â³ ä¿å­˜ä¸­...';
				}

				try {
					const itemId = document.getElementById('editItemId').value;
					const containerId = document.getElementById('editContainerId').value;
					const title = document.getElementById('editTitle').value.trim();
					const time = document.getElementById('editTime').value.trim();
					const content = document.getElementById('editContent').value.trim();
					const images = document.getElementById('editImages').value.trim();
					const videos = document.getElementById('editVideos').value.trim();

					if (!title || !time || !content) {
						alert('è¯·å¡«å†™å¿…å¡«å­—æ®µ');
						return;
					}

					const token = localStorage.getItem('token') || sessionStorage.getItem('token');
					const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';

					const requestData = {
						title: title,
						time: time,
						content: [{
							itemContent: content
						}],
						images: images ? images.split(',').map(url => url.trim()) : [],
						videos: videos ? videos.split(',').map(url => url.trim()) : []
					};

					const response = await fetch(`${apiBaseUrl}/timeline-data/${itemId}`, {
						method: 'PUT',
						headers: {
							'Authorization': `Bearer ${token}`,
							'Content-Type': 'application/json'
						},
						body: JSON.stringify(requestData)
					});

					const result = await response.json();

					if (result.success) {
						// å…³é—­è¡¨å•
						closeEditForm();

						// æ˜¾ç¤ºåŠ è½½çŠ¶æ€
						showLoadingMessage('ç¼–è¾‘æˆåŠŸï¼Œæ­£åœ¨åˆ·æ–°æ•°æ®...');

						// é‡æ–°åŠ è½½æ•°æ®
						const type = containerId === 'myPastContainer' ? 'myPast' : 'health';
						const data = await loadTimelineData(type);
						renderTimeline(containerId, data, {
							iconText: containerId === 'myPastContainer' ? 'ğŸ“…' : 'ğŸ¥',
							titleField: 'title',
							timeField: 'time',
							contentField: 'content',
							imagesField: 'images',
							videosField: 'videos'
						});

						// éšè—åŠ è½½çŠ¶æ€
						hideLoadingMessage();

						// æ˜¾ç¤ºæˆåŠŸæç¤º
						showSuccessMessage('ç¼–è¾‘æˆåŠŸï¼');
					} else {
						alert('ç¼–è¾‘å¤±è´¥: ' + result.message);
					}
				} catch (error) {
					console.error('ç¼–è¾‘å¤±è´¥:', error);
					alert('ç¼–è¾‘å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
				} finally {
					// æ¢å¤æŒ‰é’®çŠ¶æ€
					const submitBtn = document.querySelector('#editItemForm button[type="submit"]');
					if (submitBtn) {
						submitBtn.disabled = false;
						submitBtn.textContent = 'ä¿å­˜';
					}
				}
			}

			// æäº¤ç¼–è¾‘ç‰ˆæœ¬
			async function submitEditChangelog() {
				try {
					const changelogId = document.getElementById('editChangelogId').value;
					const version = document.getElementById('editVersion').value.trim();
					const time = document.getElementById('editChangelogTime').value.trim();

					if (!version || !time) {
						alert('è¯·å¡«å†™å¿…å¡«å­—æ®µ');
						return;
					}

					const token = localStorage.getItem('token') || sessionStorage.getItem('token');
					const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';

					const requestData = {
						version: version,
						time: formatTimeWithSeconds(time)
					};

					const response = await fetch(`${apiBaseUrl}/changelog/${changelogId}`, {
						method: 'PUT',
						headers: {
							'Authorization': `Bearer ${token}`,
							'Content-Type': 'application/json'
						},
						body: JSON.stringify(requestData)
					});

					const result = await response.json();

					if (result.success) {
						// å…³é—­è¡¨å•
						closeEditChangelogForm();

						// æ˜¾ç¤ºåŠ è½½çŠ¶æ€
						showLoadingMessage('ç¼–è¾‘æˆåŠŸï¼Œæ­£åœ¨åˆ·æ–°æ•°æ®...');

						// é‡æ–°åŠ è½½æ•°æ®
						await loadAllData();

						// é‡æ–°å¤„ç†é”šç‚¹è·³è½¬
						handleAnchorNavigation();

						// éšè—åŠ è½½çŠ¶æ€
						hideLoadingMessage();

						// æ˜¾ç¤ºæˆåŠŸæç¤º
						showSuccessMessage('ç¼–è¾‘æˆåŠŸï¼');
					} else {
						alert('ç¼–è¾‘å¤±è´¥: ' + result.message);
					}
				} catch (error) {
					console.error('ç¼–è¾‘å¤±è´¥:', error);
					alert('ç¼–è¾‘å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
				}
			}

			// æäº¤ç¼–è¾‘å­æ¡ç›®
			async function submitEditChangelogItem() {
				try {
					const changelogId = document.getElementById('editChangelogItemId').value;
					const itemIndex = parseInt(document.getElementById('editChangelogItemIndex').value);
					const itemContent = document.getElementById('editChangelogItemContent').value.trim();
					const timeSetting = document.getElementById('editItemTimeSetting');
					const manualTimeInput = document.getElementById('editItemManualTimeInput');
					const useAutoTime = !timeSetting || timeSetting.value === 'auto';
					let itemTime = '';

					if (useAutoTime) {
						// è‡ªåŠ¨è®¾ç½®æ—¶é—´ï¼ˆUTC+8ï¼‰
						const now = new Date();
						const utc8Time = new Date(now.getTime() + (8 * 60 * 60 * 1000));
						itemTime = formatTimeWithSeconds(utc8Time.toISOString().slice(0, 19).replace('T', ' '));
					} else if (manualTimeInput && manualTimeInput.value) {
						// æ‰‹åŠ¨è®¾ç½®æ—¶é—´
						const selectedTime = new Date(manualTimeInput.value);
						const manualUtc8Time = new Date(selectedTime.getTime() + (8 * 60 * 60 * 1000));
						itemTime = formatTimeWithSeconds(manualUtc8Time.toISOString().slice(0, 19).replace('T', ' '));
					}

					if (!itemContent) {
						alert('è¯·å¡«å†™å¿…å¡«å­—æ®µ');
						return;
					}

					const token = localStorage.getItem('token') || sessionStorage.getItem('token');
					const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';

					// ç›´æ¥è°ƒç”¨å­æ¡ç›®æ›´æ–°æ¥å£
					const response = await fetch(`${apiBaseUrl}/changelog/${changelogId}/items/${itemIndex}`, {
						method: 'PUT',
						headers: {
							'Authorization': `Bearer ${token}`,
							'Content-Type': 'application/json'
						},
						body: JSON.stringify({ itemTime, itemContent, useAutoTime })
					});

					const result = await response.json();

					if (result.success) {
						// å…³é—­è¡¨å•
						closeEditChangelogItemForm();

						// é‡æ–°åŠ è½½æ•°æ®
						await loadAllData();

						// é‡æ–°å¤„ç†é”šç‚¹è·³è½¬
						handleAnchorNavigation();

						// æ˜¾ç¤ºæˆåŠŸæç¤º
						showSuccessMessage('ç¼–è¾‘æˆåŠŸï¼');
					} else {
						alert('ç¼–è¾‘å¤±è´¥: ' + result.message);
					}
				} catch (error) {
					console.error('ç¼–è¾‘å¤±è´¥:', error);
					alert('ç¼–è¾‘å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
				}
			}

			// åˆ é™¤æ—¶é—´è½´é¡¹
			async function deleteTimelineItem(item, containerId) {
				console.log('åˆ é™¤é¡¹ç›®:', item, 'ç”¨æˆ·è§’è‰²:', globalUserRole, 'åˆ é™¤æƒé™:', globalHasDeletePermission);

				if (globalHasDeletePermission) {
					if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¡¹ç›®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
						try {
							const token = localStorage.getItem('token') || sessionStorage.getItem('token');
							const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';

							// æ ¹æ®å®¹å™¨ç±»å‹ç¡®å®šåˆ é™¤çš„APIç«¯ç‚¹
							let deleteUrl;
							if (containerId === 'versionLogContainer') {
								deleteUrl = `${apiBaseUrl}/changelog/${item._id}`;
							} else {
								deleteUrl = `${apiBaseUrl}/timeline-data/${item._id}`;
							}

							const response = await fetch(deleteUrl, {
								method: 'DELETE',
								headers: {
									'Authorization': `Bearer ${token}`,
									'Content-Type': 'application/json'
								}
							});

							const result = await response.json();

							if (result.success) {
								// æ˜¾ç¤ºåŠ è½½çŠ¶æ€
								showLoadingMessage('åˆ é™¤æˆåŠŸï¼Œæ­£åœ¨åˆ·æ–°æ•°æ®...');

								// é‡æ–°åŠ è½½æ•°æ®
								await loadAllData();

								// é‡æ–°å¤„ç†é”šç‚¹è·³è½¬
								handleAnchorNavigation();

								// éšè—åŠ è½½çŠ¶æ€
								hideLoadingMessage();

								// æ˜¾ç¤ºæˆåŠŸæç¤º
								showSuccessMessage('åˆ é™¤æˆåŠŸï¼');
							} else {
								alert('åˆ é™¤å¤±è´¥: ' + result.message);
							}
						} catch (error) {
							console.error('åˆ é™¤å¤±è´¥:', error);
							alert('åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
						}
					}
				} else {
					alert('æƒé™ä¸è¶³ï¼Œåªæœ‰å¼€å‘è€…å¯ä»¥åˆ é™¤é¡¹ç›®');
				}
			}

			// ç”¨æˆ·è§’è‰²ç¼“å­˜
			let userRoleCache = null;
			let userRoleTimestamp = 0;
			const ROLE_CACHE_DURATION = 5 * 60 * 1000; // 5åˆ†é’Ÿç¼“å­˜

			// è·å–ç”¨æˆ·è§’è‰²ï¼ˆå¸¦ç¼“å­˜ï¼Œå‡å°‘æ—¥å¿—è¾“å‡ºï¼‰
			async function getUserRole() {
				try {
					const token = localStorage.getItem('token') || sessionStorage.getItem('token');
					if (!token) {
						return 'guest';
					}

					// æ£€æŸ¥ç¼“å­˜
					const now = Date.now();
					if (userRoleCache && (now - userRoleTimestamp) < ROLE_CACHE_DURATION) {
						return userRoleCache;
					}

					// ä»APIè·å–ç”¨æˆ·ä¿¡æ¯
					const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';
					const response = await fetch(`${apiBaseUrl}/test/user`, {
						headers: {
							'Authorization': `Bearer ${token}`,
							'Content-Type': 'application/json'
						}
					});

					if (response.ok) {
						const result = await response.json();
						if (result.success && result.data && result.data.user) {
							const user = result.data.user;
							const username = user.username || user.name || '';
							const role = user.role || '';

							console.log('ä»APIè·å–ç”¨æˆ·ä¿¡æ¯:', username, 'è§’è‰²:', role);

							// ç¡®å®šæœ€ç»ˆè§’è‰²
							let finalRole = 'guest';
							if (role) {
								if (role === 'developer' || role === 'dev') finalRole = 'developer';
								else if (role === 'admin' || role === 'administrator') finalRole = 'admin';
								else if (role === 'user' || role === 'normal') finalRole = 'user';
							}

							// æ›´æ–°ç¼“å­˜
							userRoleCache = finalRole;
							userRoleTimestamp = now;

							return finalRole;
						}
					}

					return 'guest';
				} catch (error) {
					console.error('è·å–ç”¨æˆ·è§’è‰²å¤±è´¥:', error);
					return 'guest';
				}
			}

			// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ˜¯å¼€å‘è€…
			async function isDeveloper() {
				const role = await getUserRole();
				return role === 'developer';
			}

			// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ˜¯ç®¡ç†å‘˜
			async function isAdmin() {
				const role = await getUserRole();
				return role === 'admin';
			}

			// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰ç¼–è¾‘æƒé™ï¼ˆå¼€å‘è€…å’Œç®¡ç†å‘˜ï¼‰
			async function hasEditPermission() {
				const role = await getUserRole();
				return role === 'developer' || role === 'admin';
			}

			// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰åˆ é™¤æƒé™ï¼ˆåªæœ‰å¼€å‘è€…ï¼‰
			async function hasDeletePermission() {
				const role = await getUserRole();
				return role === 'developer';
			}

			// ç®€åŒ–çš„æƒé™æ£€æŸ¥å‡½æ•°
			function canEdit() {
				return globalUserRole === 'developer' || globalUserRole === 'admin';
			}

			function canDelete() {
				return globalUserRole === 'developer';
			}

			// ç™»å½•çŠ¶æ€ç¼“å­˜
			let loginStatusCache = null;
			let loginStatusTimestamp = 0;
			const LOGIN_CACHE_DURATION = 30 * 1000; // 30ç§’ç¼“å­˜

			// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼ˆå¸¦ç¼“å­˜ï¼Œå‡å°‘æ—¥å¿—è¾“å‡ºï¼‰
			function isUserLoggedIn() {
				// æ£€æŸ¥ç¼“å­˜
				const now = Date.now();
				if (loginStatusCache !== null && (now - loginStatusTimestamp) < LOGIN_CACHE_DURATION) {
					return loginStatusCache;
				}

				const localToken = localStorage.getItem('token');
				const sessionToken = sessionStorage.getItem('token');
				const token = localToken || sessionToken;
				const hasToken = !!token;

				// åªåœ¨ç¬¬ä¸€æ¬¡æ£€æŸ¥æ—¶è¾“å‡ºè¯¦ç»†ä¿¡æ¯
				if (loginStatusCache === null) {
					console.log('=== ç™»å½•çŠ¶æ€æ£€æŸ¥ ===');
					console.log('localStorage token:', localToken ? `å­˜åœ¨ (${localToken.length}å­—ç¬¦)` : 'ä¸å­˜åœ¨');
					console.log('sessionStorage token:', sessionToken ? `å­˜åœ¨ (${sessionToken.length}å­—ç¬¦)` : 'ä¸å­˜åœ¨');
					console.log('æœ€ç»ˆä½¿ç”¨token:', token ? `å­˜åœ¨ (${token.length}å­—ç¬¦)` : 'ä¸å­˜åœ¨');
					console.log('ç™»å½•çŠ¶æ€:', hasToken);
					console.log('========================');
				}

				// æ›´æ–°ç¼“å­˜
				loginStatusCache = hasToken;
				loginStatusTimestamp = now;

				return hasToken;
			}

			// æ¸…é™¤æ‰€æœ‰ç¼“å­˜
			function clearAllCache() {
				loginStatusCache = null;
				loginStatusTimestamp = 0;
				userRoleCache = null;
				userRoleTimestamp = 0;
				console.log('æ‰€æœ‰ç¼“å­˜å·²æ¸…é™¤');
			}

			// æ‰‹åŠ¨æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯ï¼ˆè°ƒè¯•ç”¨ï¼‰
			async function checkTokenContent() {
				const localToken = localStorage.getItem('token');
				const sessionToken = sessionStorage.getItem('token');
				const token = localToken || sessionToken;

				console.log('=== ç”¨æˆ·ä¿¡æ¯æ£€æŸ¥ ===');
				if (token) {
					console.log('Tokenå­˜åœ¨ï¼Œé•¿åº¦:', token.length);

					// æ˜¾ç¤ºå½“å‰ç¼“å­˜çŠ¶æ€
					console.log('ç™»å½•çŠ¶æ€ç¼“å­˜:', loginStatusCache);
					console.log('ç”¨æˆ·è§’è‰²ç¼“å­˜:', userRoleCache);

					try {
						// æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶é‡æ–°è·å–
						clearAllCache();

						// ä»APIè·å–ç”¨æˆ·ä¿¡æ¯
						const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';
						const response = await fetch(`${apiBaseUrl}/test/user`, {
							headers: {
								'Authorization': `Bearer ${token}`,
								'Content-Type': 'application/json'
							}
						});

						if (response.ok) {
							const result = await response.json();
							if (result.success && result.data && result.data.user) {
								console.log('APIè¿”å›çš„ç”¨æˆ·ä¿¡æ¯:', result.data.user);
								console.log('ç”¨æˆ·å:', result.data.user.username || result.data.user.name || 'æœªæ‰¾åˆ°');
								console.log('è§’è‰²:', result.data.user.role || 'æœªæ‰¾åˆ°');
								console.log('é‚®ç®±:', result.data.user.email || 'æœªæ‰¾åˆ°');
							} else {
								console.log('APIè¿”å›æ•°æ®æ ¼å¼é”™è¯¯:', result);
							}
						} else {
							console.log('APIè¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status);
							const errorText = await response.text();
							console.log('é”™è¯¯ä¿¡æ¯:', errorText);
						}
					} catch (error) {
						console.log('APIè¯·æ±‚å¼‚å¸¸:', error);
					}
				} else {
					console.log('æ²¡æœ‰æ‰¾åˆ°token');
				}
				console.log('==================');
			}

			// æ˜¾ç¤ºæ·»åŠ è¡¨å•
			function showAddForm(type) {
				const formHtml = `
					<div id="addFormOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; justify-content: center; align-items: center;">
						<div style="background: white; padding: 20px; border-radius: 10px; width: 80%; max-width: 500px; max-height: 80vh; overflow-y: auto;">
							<h3>æ·»åŠ æ–°æ¡ç›® (${type === 'myPastData' ? 'My Past' : 'Health'})</h3>
							<form id="addItemForm">
								<div style="margin-bottom: 15px;">
									<label>æ ‡é¢˜:</label><br>
									<input type="text" id="addTitle" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
								</div>
								<div style="margin-bottom: 15px;">
									<label>æ—¶é—´:</label><br>
									<input type="text" value="è‡ªåŠ¨ä½¿ç”¨åˆ›å»ºæ—¶é—´" disabled style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; background-color: #f5f5f5; color: #666;">
								</div>
								<div style="margin-bottom: 15px;">
									<label>å†…å®¹:</label><br>
									<textarea id="addContent" required style="width: 100%; height: 100px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="è¯·è¾“å…¥å†…å®¹..."></textarea>
								</div>
								<div style="margin-bottom: 15px;">
									<label>å›¾ç‰‡URL (å¯é€‰ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”):</label><br>
									<input type="text" id="addImages" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="ä¾‹å¦‚: /images/photo1.jpg, /images/photo2.jpg">
								</div>
								<div style="margin-bottom: 15px;">
									<label>è§†é¢‘URL (å¯é€‰ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”):</label><br>
									<input type="text" id="addVideos" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="ä¾‹å¦‚: /videos/video1.mp4, /videos/video2.mp4">
								</div>
								<div style="text-align: right;">
									<button type="button" onclick="closeAddForm()" style="background: #95a5a6; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px;">å–æ¶ˆ</button>
									<button type="submit" style="background: #16A085; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">æ·»åŠ </button>
								</div>
							</form>
						</div>
					</div>
				`;

				document.body.insertAdjacentHTML('beforeend', formHtml);

				// æ·»åŠ ESCé”®å…³é—­åŠŸèƒ½
				const overlay = document.getElementById('addFormOverlay');
				overlay.addEventListener('keydown', function (e) {
					if (e.key === 'Escape') {
						closeAddForm();
					}
				});

				// æ·»åŠ è¡¨å•æäº¤äº‹ä»¶
				document.getElementById('addItemForm').onsubmit = (e) => {
					e.preventDefault();
					submitNewItem(type);
				};
			}

			// æ˜¾ç¤ºæ·»åŠ æ›´æ–°æ—¥å¿—è¡¨å•
			async function showAddChangelogForm() {
				// é˜²æ­¢é‡å¤ç‚¹å‡»
				const addBtn = document.getElementById('addChangelogBtn');
				if (addBtn) {
					addBtn.disabled = true;
					addBtn.textContent = 'â³ åŠ è½½ä¸­...';
				}

				try {
					// æ£€æŸ¥æ˜¯å¦ä¸ºå¼€å‘è€…
					const isDeveloper = globalUserRole === 'developer';

					// è·å–æœ€å¤§çš„orderå€¼
					const maxOrder = await getMaxOrderValue();
					const defaultOrder = maxOrder + 1;

					const timeSection = isDeveloper ? `
					<div style="margin-bottom: 15px;">
						<label>æ—¶é—´è®¾ç½®:</label><br>
						<select id="versionTimeSetting" onchange="toggleVersionTimeInput()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
							<option value="auto">è‡ªåŠ¨è®¾ç½®æ—¶é—´ï¼ˆUTC+8ï¼‰</option>
							<option value="manual">æ‰‹åŠ¨è®¾ç½®æ—¶é—´</option>
						</select>
						<input type="datetime-local" id="versionManualTimeInput" step="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; display: none;" placeholder="é€‰æ‹©æ—¶é—´">
					</div>
				` : `
					<div style="margin-bottom: 15px;">
						<label>æ—¶é—´:</label><br>
						<input type="text" value="è‡ªåŠ¨ä½¿ç”¨åˆ›å»ºæ—¶é—´ï¼ˆUTC+8ï¼‰" disabled style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; background-color: #f5f5f5; color: #666;">
					</div>
				`;

					const formHtml = `
					<div id="addChangelogFormOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; justify-content: center; align-items: center;">
						<div style="background: white; padding: 20px; border-radius: 10px; width: 80%; max-width: 500px; max-height: 80vh; overflow-y: auto;">
							<h3>æ·»åŠ æ–°ç‰ˆæœ¬</h3>
							<form id="addChangelogForm">
								<div style="margin-bottom: 15px;">
									<label>ç‰ˆæœ¬å·:</label><br>
									<input type="text" id="addVersion" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="ä¾‹å¦‚: v5.0.5">
								</div>
								<div style="margin-bottom: 15px;">
									<label>æ’åºå€¼ (å½“å‰æœ€å¤§: ${maxOrder}):</label><br>
									<input type="number" id="addOrder" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" value="${defaultOrder}" min="1" placeholder="è¯·è¾“å…¥æ’åºå€¼">
								</div>
								${timeSection}
								<div style="text-align: right;">
									<button type="button" onclick="closeAddChangelogForm()" style="background: #95a5a6; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px;">å–æ¶ˆ</button>
									<button type="submit" style="background: #16A085; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">æ·»åŠ ç‰ˆæœ¬</button>
								</div>
							</form>
						</div>
					</div>
				`;

					document.body.insertAdjacentHTML('beforeend', formHtml);

					// æ·»åŠ ESCé”®å…³é—­åŠŸèƒ½
					const overlay = document.getElementById('addChangelogFormOverlay');
					overlay.addEventListener('keydown', function (e) {
						if (e.key === 'Escape') {
							closeAddChangelogForm();
						}
					});

					// æ·»åŠ è¡¨å•æäº¤äº‹ä»¶
					document.getElementById('addChangelogForm').onsubmit = (e) => {
						e.preventDefault();
						submitNewChangelog();
					};
				} catch (error) {
					console.error('åŠ è½½è¡¨å•å¤±è´¥:', error);
					alert('åŠ è½½è¡¨å•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
				} finally {
					// æ¢å¤æŒ‰é’®çŠ¶æ€
					const addBtn = document.getElementById('addChangelogBtn');
					if (addBtn) {
						addBtn.disabled = false;
						addBtn.textContent = 'â• æ·»åŠ æ–°ç‰ˆæœ¬';
					}
				}
			}

			// æ˜¾ç¤ºæ·»åŠ æ¡ç›®è¡¨å•
			function showAddChangelogItemForm(versionId, versionName) {
				// æ£€æŸ¥æ˜¯å¦ä¸ºå¼€å‘è€…
				const isDeveloper = globalUserRole === 'developer';

				const timeSection = isDeveloper ? `
					<div style="margin-bottom: 15px;">
						<label>æ—¶é—´è®¾ç½®:</label><br>
						<select id="timeSetting" onchange="toggleTimeInput()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
							<option value="auto">è‡ªåŠ¨è®¾ç½®æ—¶é—´ï¼ˆUTC+8ï¼‰</option>
							<option value="manual">æ‰‹åŠ¨è®¾ç½®æ—¶é—´</option>
						</select>
						<input type="datetime-local" id="manualTimeInput" step="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; display: none;" placeholder="é€‰æ‹©æ—¶é—´">
					</div>
				` : `
					<div style="margin-bottom: 15px;">
						<label>æ—¶é—´:</label><br>
						<input type="text" value="è‡ªåŠ¨ä½¿ç”¨åˆ›å»ºæ—¶é—´ï¼ˆUTC+8ï¼‰" disabled style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; background-color: #f5f5f5; color: #666;">
					</div>
				`;

				const formHtml = `
					<div id="addChangelogItemFormOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; justify-content: center; align-items: center;">
						<div style="background: white; padding: 20px; border-radius: 10px; width: 80%; max-width: 500px; max-height: 80vh; overflow-y: auto;">
							<h3>æ·»åŠ æ¡ç›®åˆ° ${versionName}</h3>
							<form id="addChangelogItemForm">
								<input type="hidden" id="addItemVersionId" value="${versionId}">
								<div style="margin-bottom: 15px;">
									<label>æ¡ç›®å†…å®¹: <span style="font-size: 0.8em; color: #666;">(æ”¯æŒ Markdown å’Œ HTML)</span></label><br>
									<textarea id="addChangelogItemContent" required style="width: 100%; height: 100px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="è¯·è¾“å…¥æ¡ç›®å†…å®¹...æ”¯æŒ Markdown è¯­æ³•å¦‚ **ç²—ä½“**ã€*æ–œä½“*ã€[é“¾æ¥](url) ç­‰"></textarea>
									<div style="margin-top: 5px; font-size: 0.8em; color: #666;">
										<strong>æ”¯æŒæ ¼å¼:</strong> Markdown (**, *, #, >, \`, \`\`\`), HTML æ ‡ç­¾ (å®‰å…¨è¿‡æ»¤)
									</div>
									<button type="button" onclick="previewContent('addChangelogItemContent')" style="margin-top: 5px; padding: 4px 8px; background: #16A085; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 0.8em;">é¢„è§ˆå†…å®¹</button>
								</div>
								${timeSection}
								<div style="text-align: right;">
									<button type="button" onclick="closeAddChangelogItemForm()" style="background: #95a5a6; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px;">å–æ¶ˆ</button>
									<button type="submit" style="background: #16A085; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">æ·»åŠ æ¡ç›®</button>
								</div>
							</form>
						</div>
					</div>
				`;

				document.body.insertAdjacentHTML('beforeend', formHtml);

				// æ·»åŠ ESCé”®å…³é—­åŠŸèƒ½
				const overlay = document.getElementById('addChangelogItemFormOverlay');
				overlay.addEventListener('keydown', function (e) {
					if (e.key === 'Escape') {
						closeAddChangelogItemForm();
					}
				});

				// æ·»åŠ è¡¨å•æäº¤äº‹ä»¶
				document.getElementById('addChangelogItemForm').onsubmit = (e) => {
					e.preventDefault();
					submitNewChangelogItem();
				};
			}

			// å…³é—­æ·»åŠ è¡¨å•
			function closeAddForm() {
				const overlay = document.getElementById('addFormOverlay');
				if (overlay) {
					overlay.remove();
				}
			}

			// å…³é—­æ·»åŠ æ›´æ–°æ—¥å¿—è¡¨å•
			function closeAddChangelogForm() {
				const overlay = document.getElementById('addChangelogFormOverlay');
				if (overlay) {
					overlay.remove();
				}
			}

			/**
			* æ ¼å¼åŒ–æ—¶é—´å­—ç¬¦ä¸²ï¼Œç¡®ä¿åŒ…å«ç§’çº§ç²¾åº¦
			* @param {string} timeStr - è¾“å…¥çš„æ—¶é—´å­—ç¬¦ä¸²
			* @returns {string} åŒ…å«ç§’çº§ç²¾åº¦çš„æ—¶é—´å­—ç¬¦ä¸²
			*/
			function formatTimeWithSeconds(timeStr) {
				if (!timeStr) return '';

				// æ£€æŸ¥æ—¶é—´æ ¼å¼æ˜¯å¦å·²åŒ…å«ç§’
				const timeParts = timeStr.split(' ');
				if (timeParts.length < 2) return timeStr;

				const datePart = timeParts[0];
				let timePart = timeParts[1];

				// æ£€æŸ¥æ—¶é—´éƒ¨åˆ†æ˜¯å¦åŒ…å«ç§’
				if (timePart.split(':').length === 2) {
					// åªæœ‰å°æ—¶å’Œåˆ†é’Ÿï¼Œæ·»åŠ ç§’
					timePart += ':00';
				}

				return `${datePart} ${timePart}`;
			}

			// åˆ‡æ¢æ—¶é—´è¾“å…¥æ˜¾ç¤º
			function toggleTimeInput() {
				const timeSetting = document.getElementById('timeSetting');
				const manualTimeInput = document.getElementById('manualTimeInput');

				if (timeSetting && manualTimeInput) {
					if (timeSetting.value === 'manual') {
						manualTimeInput.style.display = 'block';
						// è®¾ç½®é»˜è®¤å€¼ä¸ºå½“å‰æ—¶é—´ï¼ˆUTC+8ï¼‰
						const now = new Date();
						const utc8Time = new Date(now.getTime() + (8 * 60 * 60 * 1000));
						manualTimeInput.value = utc8Time.toISOString().slice(0, 19);
					} else {
						manualTimeInput.style.display = 'none';
					}
				}
			}

			// åˆ‡æ¢ç‰ˆæœ¬æ—¶é—´è¾“å…¥æ˜¾ç¤º
			function toggleVersionTimeInput() {
				const versionTimeSetting = document.getElementById('versionTimeSetting');
				const versionManualTimeInput = document.getElementById('versionManualTimeInput');

				if (versionTimeSetting && versionManualTimeInput) {
					if (versionTimeSetting.value === 'manual') {
						versionManualTimeInput.style.display = 'block';
						// è®¾ç½®é»˜è®¤å€¼ä¸ºå½“å‰æ—¶é—´ï¼ˆUTC+8ï¼‰
						const now = new Date();
						const utc8Time = new Date(now.getTime() + (8 * 60 * 60 * 1000));
						versionManualTimeInput.value = utc8Time.toISOString().slice(0, 19);
					} else {
						versionManualTimeInput.style.display = 'none';
					}
				}
			}


			// åˆ‡æ¢ç¼–è¾‘å­æ¡ç›®æ—¶é—´è¾“å…¥æ˜¾ç¤º
			function toggleEditItemTimeInput() {
				const editItemTimeSetting = document.getElementById('editItemTimeSetting');
				const editItemManualTimeInput = document.getElementById('editItemManualTimeInput');

				if (editItemTimeSetting && editItemManualTimeInput) {
					if (editItemTimeSetting.value === 'manual') {
						editItemManualTimeInput.style.display = 'block';
						// è®¾ç½®é»˜è®¤å€¼ä¸ºå½“å‰æ—¶é—´ï¼ˆUTC+8ï¼‰
						const now = new Date();
						const utc8Time = new Date(now.getTime() + (8 * 60 * 60 * 1000));
						editItemManualTimeInput.value = utc8Time.toISOString().slice(0, 19);
					} else {
						editItemManualTimeInput.style.display = 'none';
					}
				}
			}

			// å…³é—­æ·»åŠ æ¡ç›®è¡¨å•
			function closeAddChangelogItemForm() {
				const overlay = document.getElementById('addChangelogItemFormOverlay');
				if (overlay) {
					overlay.remove();
				}
			}

			// æäº¤æ–°æ¡ç›®
			async function submitNewItem(type) {
				try {
					const title = document.getElementById('addTitle').value.trim();
					const content = document.getElementById('addContent').value.trim();
					const images = document.getElementById('addImages').value.trim();
					const videos = document.getElementById('addVideos').value.trim();

					if (!title || !content) {
						alert('è¯·å¡«å†™å¿…å¡«å­—æ®µ');
						return;
					}

					const token = localStorage.getItem('token') || sessionStorage.getItem('token');
					const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';

					const requestData = {
						type: type === 'myPastData' ? 'myPast' : 'health',
						title: title,
						content: [{
							itemContent: content
						}],
						images: images ? images.split(',').map(url => url.trim()) : [],
						videos: videos ? videos.split(',').map(url => url.trim()) : []
					};

					const response = await fetch(`${apiBaseUrl}/timeline-data`, {
						method: 'POST',
						headers: {
							'Authorization': `Bearer ${token}`,
							'Content-Type': 'application/json'
						},
						body: JSON.stringify(requestData)
					});

					const result = await response.json();

					if (result.success) {
						// å…³é—­è¡¨å•
						closeAddForm();

						// æ˜¾ç¤ºåŠ è½½çŠ¶æ€
						showLoadingMessage('æ·»åŠ æˆåŠŸï¼Œæ­£åœ¨åˆ·æ–°æ•°æ®...');

						// é‡æ–°åŠ è½½æ•°æ®
						const data = await loadTimelineData(type === 'myPastData' ? 'myPast' : 'health');
						const containerId = type === 'myPastData' ? 'myPastContainer' : 'healthContainer';
						renderTimeline(containerId, data, {
							iconText: type === 'myPastData' ? 'ğŸ“…' : 'ğŸ¥',
							titleField: 'title',
							timeField: 'time',
							contentField: 'content',
							imagesField: 'images',
							videosField: 'videos'
						});

						// éšè—åŠ è½½çŠ¶æ€
						hideLoadingMessage();

						// æ˜¾ç¤ºæˆåŠŸæç¤º
						showSuccessMessage('æ·»åŠ æˆåŠŸï¼');
					} else {
						alert('æ·»åŠ å¤±è´¥: ' + result.message);
					}
				} catch (error) {
					console.error('æ·»åŠ å¤±è´¥:', error);
					alert('æ·»åŠ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
				}
			}

			// æäº¤æ–°æ›´æ–°æ—¥å¿—ç‰ˆæœ¬
			async function submitNewChangelog() {
				// é˜²æ­¢é‡å¤æäº¤
				const submitBtn = document.querySelector('#addChangelogForm button[type="submit"]');
				if (submitBtn) {
					submitBtn.disabled = true;
					submitBtn.textContent = 'â³ æäº¤ä¸­...';
				}

				try {
					const version = document.getElementById('addVersion').value.trim();
					const order = parseInt(document.getElementById('addOrder').value);

					if (!version) {
						alert('è¯·å¡«å†™ç‰ˆæœ¬å·');
						return;
					}

					if (!order || order < 1) {
						alert('è¯·å¡«å†™æœ‰æ•ˆçš„æ’åºå€¼');
						return;
					}

					const token = localStorage.getItem('token') || sessionStorage.getItem('token');
					const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';

					const requestData = {
						version: version,
						order: order
					};

					// æ£€æŸ¥æ˜¯å¦ä¸ºå¼€å‘è€…ä¸”é€‰æ‹©æ‰‹åŠ¨è®¾ç½®æ—¶é—´
					const isDeveloper = globalUserRole === 'developer';
					// è·å–å½“å‰æ—¶é—´ï¼ˆUTC+8ï¼‰
					const now = new Date();
					const utc8Time = new Date(now.getTime() + (8 * 60 * 60 * 1000));
					const formattedTime = formatTimeWithSeconds(utc8Time.toISOString().slice(0, 19).replace('T', ' '));

					if (isDeveloper) {
						const versionTimeSetting = document.getElementById('versionTimeSetting');
						const versionManualTimeInput = document.getElementById('versionManualTimeInput');

						if (versionTimeSetting && versionTimeSetting.value === 'manual' && versionManualTimeInput && versionManualTimeInput.value) {
							// å¼€å‘è€…é€‰æ‹©æ‰‹åŠ¨è®¾ç½®æ—¶é—´
							const selectedTime = new Date(versionManualTimeInput.value);
							const manualUtc8Time = new Date(selectedTime.getTime() + (8 * 60 * 60 * 1000));
							requestData.time = formatTimeWithSeconds(manualUtc8Time.toISOString().slice(0, 19).replace('T', ' '));
							requestData.useAutoTime = false;
						} else {
							// å¼€å‘è€…é€‰æ‹©è‡ªåŠ¨è®¾ç½®æ—¶é—´
							requestData.time = formattedTime;
							requestData.useAutoTime = true;
						}
					} else {
						// éå¼€å‘è€…åªèƒ½ä½¿ç”¨è‡ªåŠ¨æ—¶é—´
						requestData.time = formattedTime;
						requestData.useAutoTime = true;
					}

					const response = await fetch(`${apiBaseUrl}/changelog`, {
						method: 'POST',
						headers: {
							'Authorization': `Bearer ${token}`,
							'Content-Type': 'application/json'
						},
						body: JSON.stringify(requestData)
					});

					const result = await response.json();

					if (result.success) {
						// æ˜¾ç¤ºæˆåŠŸæç¤ºå¹¶å…³é—­è¡¨å•
						closeAddChangelogForm();

						// æ˜¾ç¤ºåŠ è½½çŠ¶æ€
						showLoadingMessage('ç‰ˆæœ¬æ·»åŠ æˆåŠŸï¼Œæ­£åœ¨åˆ·æ–°æ•°æ®...');

						// é‡æ–°åŠ è½½å¹¶æ¸²æŸ“æ‰€æœ‰æ•°æ®
						await loadAllData();

						// é‡æ–°å¤„ç†é”šç‚¹è·³è½¬
						handleAnchorNavigation();

						// éšè—åŠ è½½çŠ¶æ€
						hideLoadingMessage();

						// æ˜¾ç¤ºæˆåŠŸæç¤º
						showSuccessMessage('ç‰ˆæœ¬æ·»åŠ æˆåŠŸï¼');
					} else {
						alert('æ·»åŠ å¤±è´¥: ' + result.message);
					}
				} catch (error) {
					console.error('æ·»åŠ å¤±è´¥:', error);
					alert('æ·»åŠ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
				} finally {
					// æ¢å¤æŒ‰é’®çŠ¶æ€
					const submitBtn = document.querySelector('#addChangelogForm button[type="submit"]');
					if (submitBtn) {
						submitBtn.disabled = false;
						submitBtn.textContent = 'æ·»åŠ ç‰ˆæœ¬';
					}
				}
			}

			// æäº¤æ–°æ¡ç›®
			async function submitNewChangelogItem() {
				// é˜²æ­¢é‡å¤æäº¤
				const submitBtn = document.querySelector('#addChangelogItemForm button[type="submit"]');
				if (submitBtn) {
					submitBtn.disabled = true;
					submitBtn.textContent = 'â³ æäº¤ä¸­...';
				}

				try {
					const versionId = document.getElementById('addItemVersionId').value;
					const itemContent = document.getElementById('addChangelogItemContent').value.trim();

					if (!itemContent) {
						alert('è¯·å¡«å†™æ¡ç›®å†…å®¹');
						return;
					}

					if (!versionId) {
						alert('ç‰ˆæœ¬IDæ— æ•ˆ');
						return;
					}

					const token = localStorage.getItem('token') || sessionStorage.getItem('token');
					if (!token) {
						alert('è¯·å…ˆç™»å½•');
						return;
					}

					const apiBaseUrl = window.OneLoveConfig?.apiBaseUrl || '/api';

					// æ„å»ºè¯·æ±‚æ•°æ®
					const requestData = {
						itemContent: itemContent
					};

					// éªŒè¯è¯·æ±‚æ•°æ®æ ¼å¼
					console.log('è¯·æ±‚æ•°æ®éªŒè¯:', {
						itemContent: typeof itemContent,
						itemContentLength: itemContent.length,
						requestData: requestData
					});

					// è·å–å½“å‰æ—¶é—´ï¼ˆUTC+8ï¼‰
					const now = new Date();
					const utc8Time = new Date(now.getTime() + (8 * 60 * 60 * 1000));
					const formattedTime = formatTimeWithSeconds(utc8Time.toISOString().slice(0, 19).replace('T', ' '));

					// æ£€æŸ¥æ˜¯å¦ä¸ºå¼€å‘è€…ä¸”é€‰æ‹©æ‰‹åŠ¨è®¾ç½®æ—¶é—´
					const isDeveloper = globalUserRole === 'developer';
					if (isDeveloper) {
						const timeSetting = document.getElementById('timeSetting');
						const manualTimeInput = document.getElementById('manualTimeInput');

						if (timeSetting && timeSetting.value === 'manual' && manualTimeInput && manualTimeInput.value) {
							// å¼€å‘è€…é€‰æ‹©æ‰‹åŠ¨è®¾ç½®æ—¶é—´
							const selectedTime = new Date(manualTimeInput.value);
							const manualUtc8Time = new Date(selectedTime.getTime() + (8 * 60 * 60 * 1000));
							requestData.itemTime = formatTimeWithSeconds(manualUtc8Time.toISOString().slice(0, 19).replace('T', ' '));
							requestData.useAutoTime = false;
						} else {
							// å¼€å‘è€…é€‰æ‹©è‡ªåŠ¨è®¾ç½®æ—¶é—´
							requestData.itemTime = formattedTime;
							requestData.useAutoTime = true;
						}
					} else {
						// éå¼€å‘è€…åªèƒ½ä½¿ç”¨è‡ªåŠ¨æ—¶é—´
						requestData.itemTime = formattedTime;
						requestData.useAutoTime = true;
					}

					// è°ƒè¯•ä¿¡æ¯
					console.log('å‘é€è¯·æ±‚æ•°æ®:', {
						url: `${apiBaseUrl}/changelog/${versionId}/items`,
						requestData: requestData,
						token: token ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨',
						userRole: globalUserRole
					});

					const response = await fetch(`${apiBaseUrl}/changelog/${versionId}/items`, {
						method: 'POST',
						headers: {
							'Authorization': `Bearer ${token}`,
							'Content-Type': 'application/json'
						},
						body: JSON.stringify(requestData)
					});

					// è°ƒè¯•å“åº”ä¿¡æ¯
					console.log('æœåŠ¡å™¨å“åº”:', {
						status: response.status,
						statusText: response.statusText,
						ok: response.ok
					});

					if (!response.ok) {
						const errorText = await response.text();
						console.error('æœåŠ¡å™¨é”™è¯¯è¯¦æƒ…:', errorText);
						throw new Error(`æœåŠ¡å™¨é”™è¯¯ (${response.status}): ${errorText}`);
					}

					const result = await response.json();

					if (result.success) {
						// æ˜¾ç¤ºæˆåŠŸæç¤ºå¹¶å…³é—­è¡¨å•
						closeAddChangelogItemForm();

						// é‡æ–°åŠ è½½å¹¶æ¸²æŸ“å…¨éƒ¨æ•°æ®ï¼Œç¡®ä¿æ–°æ¡ç›®ä¸æ—¶é—´æ˜¾ç¤º
						await loadAllData();

						// é‡æ–°å¤„ç†é”šç‚¹è·³è½¬
						handleAnchorNavigation();

						// éšè—åŠ è½½çŠ¶æ€
						hideLoadingMessage();

						// æ˜¾ç¤ºæˆåŠŸæç¤º
						showSuccessMessage('æ¡ç›®æ·»åŠ æˆåŠŸï¼');
					} else {
						alert('æ·»åŠ å¤±è´¥: ' + result.message);
					}
				} catch (error) {
					console.error('æ·»åŠ å¤±è´¥:', error);
					alert('æ·»åŠ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
				} finally {
					// æ¢å¤æŒ‰é’®çŠ¶æ€
					const submitBtn = document.querySelector('#addChangelogItemForm button[type="submit"]');
					if (submitBtn) {
						submitBtn.disabled = false;
						submitBtn.textContent = 'æ·»åŠ æ¡ç›®';
					}
				}
			}

			/**
			 * é¢„è§ˆå†…å®¹å‡½æ•°
			 * @param {string} textareaId - æ–‡æœ¬æ¡†çš„ID
			 */
			function previewContent(textareaId) {
				const textarea = document.getElementById(textareaId);
				if (!textarea) {
					alert('æ‰¾ä¸åˆ°æ–‡æœ¬æ¡†');
					return;
				}

				const content = textarea.value.trim();
				if (!content) {
					alert('è¯·å…ˆè¾“å…¥å†…å®¹');
					return;
				}

				// è§£æå†…å®¹
				const parsedResult = parseContent(content);

				// åˆ›å»ºé¢„è§ˆæ¨¡æ€æ¡†
				const modalHtml = `
					<div id="previewModalOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; display: flex; justify-content: center; align-items: center;">
						<div style="background: #34495E; color: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
							<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
								<h3>å†…å®¹é¢„è§ˆ ${parsedResult.indicator}</h3>
								<button onclick="closePreviewModal()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer;">Ã—</button>
							</div>
							<div style="border: 1px solid #555; padding: 15px; border-radius: 5px; background: #2C3E50; margin-bottom: 15px;">
								<div class="parsed-content" style="color: white;">
									${parsedResult.parsedContent}
								</div>
							</div>
							<div style="text-align: center;">
								<button onclick="closePreviewModal()" style="background: #16A085; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">å…³é—­é¢„è§ˆ</button>
							</div>
						</div>
					</div>
				`;

				document.body.insertAdjacentHTML('beforeend', modalHtml);

				// æ·»åŠ ESCé”®å…³é—­åŠŸèƒ½
				const overlay = document.getElementById('previewModalOverlay');
				overlay.addEventListener('keydown', function (e) {
					if (e.key === 'Escape') {
						closePreviewModal();
					}
				});
			}

			/**
			 * æ˜¾ç¤ºå›¾ç‰‡æ¨¡æ€æ¡†
			 */
			function showImageModal(imageUrl) {
				const modal = document.createElement('div');
				modal.className = 'modal-overlay';
				const modalImg = document.createElement('img');
				modalImg.src = imageUrl;
				modalImg.className = 'modal-image';
				modal.appendChild(modalImg);
				modal.onclick = () => modal.remove();
				document.body.appendChild(modal);
			}

			/**
			 * å…³é—­é¢„è§ˆæ¨¡æ€æ¡†
			 */
			function closePreviewModal() {
				const overlay = document.getElementById('previewModalOverlay');
				if (overlay) {
					overlay.remove();
				}
			}
		</script>
		</div>
	</article>

	<!-- æ»šåŠ¨æŒ‡ç¤ºå™¨ -->
	<div class="scroll-indicator" id="scrollIndicator" onclick="scrollToTop()">
		â†‘
	</div>

	<footer>
		Copyright Â© qAiJi
		<br />
		å¤‡æ¡ˆæ˜¯ä¸é˜”èƒ½å¤‡æ¡ˆæ»´
	</footer>

	<script>
		// æ»šåŠ¨æŒ‡ç¤ºå™¨åŠŸèƒ½
		const scrollIndicator = document.getElementById('scrollIndicator');

		// ç›‘å¬æ»šåŠ¨äº‹ä»¶
		window.addEventListener('scroll', function () {
			const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

			// å½“æ»šåŠ¨è¶…è¿‡300pxæ—¶æ˜¾ç¤ºæŒ‡ç¤ºå™¨
			if (scrollTop > 300) {
				scrollIndicator.classList.add('visible');
			} else {
				scrollIndicator.classList.remove('visible');
			}
		});

		// æ»šåŠ¨åˆ°é¡¶éƒ¨åŠŸèƒ½
		function scrollToTop() {
			window.scrollTo({
				top: 0,
				behavior: 'smooth'
			});
		}



		// æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
		document.addEventListener('keydown', function (e) {
			// Ctrl/Cmd + æ–¹å‘é”®æ»šåŠ¨
			if (e.ctrlKey || e.metaKey) {
				switch (e.key) {
					case 'ArrowUp':
						e.preventDefault();
						scrollToTop();
						break;
					case 'ArrowDown':
						e.preventDefault();
						window.scrollTo({
							top: document.body.scrollHeight,
							behavior: 'smooth'
						});
						break;
				}
			}
		});

		// æ·»åŠ è§¦æ‘¸æ»‘åŠ¨æ”¯æŒï¼ˆç§»åŠ¨ç«¯ï¼‰
		let touchStartY = 0;
		let touchEndY = 0;

		document.addEventListener('touchstart', function (e) {
			touchStartY = e.touches[0].clientY;
		});

		document.addEventListener('touchend', function (e) {
			touchEndY = e.changedTouches[0].clientY;
			const diff = touchStartY - touchEndY;

			// å‘ä¸Šæ»‘åŠ¨è¶…è¿‡50pxæ—¶æ˜¾ç¤ºæ»šåŠ¨æŒ‡ç¤ºå™¨
			if (diff > 50 && window.pageYOffset > 300) {
				scrollIndicator.classList.add('visible');
			}
		});

		// åˆå§‹åŒ–æ»šåŠ¨æ•ˆæœ
		document.addEventListener('DOMContentLoaded', function () {
			// ä¸ºæ‰€æœ‰timelineæ·»åŠ æ·¡å…¥æ•ˆæœ
			const timelineItems = document.querySelectorAll('.timeline .item');
			timelineItems.forEach((item, index) => {
				item.style.opacity = '0';
				item.style.transform = 'translateY(20px)';
				item.style.transition = 'opacity 0.5s ease, transform 0.5s ease';

				setTimeout(() => {
					item.style.opacity = '1';
					item.style.transform = 'translateY(0)';
				}, index * 100);
			});
		});
	</script>
</body>

</html>