// æ•°æ®æ¢å¤è„šæœ¬ - æ¢å¤è¢«åˆ é™¤çš„changelogç‰ˆæœ¬
const mongoose = require('mongoose');
const Changelog = require('./onelove-backend/models/Changelog');

// æ•°æ®åº“è¿æ¥é…ç½®
const mongoURI = process.env.MONGODB_URI || 'mongodb+srv://OneLoveAdminQi:LG.2457_AtlasQiAdminOneLove@onelove.bepz2u0.mongodb.net/?retryWrites=true&w=majority&appName=OneLove';

// è¢«åˆ é™¤çš„æ•°æ®
const deletedData = [
  {
    _id: '68a1bddb1c7dfd7cf49361d3',
    version: 'v5.0.5',
    order: 1755430363536,
    time: '2025-08-17 19:32:43',
    content: [
      {
        itemTime: '[2025/08/17 19:32:43]',
        itemContent: 'å®ç°changelogå­æ¡ç›®ç¼–è¾‘åŠŸèƒ½ï¼šä¸ºæ¯ä¸ªchangelogç‰ˆæœ¬ä¸­çš„å­æ¡ç›®æ·»åŠ ç‹¬ç«‹çš„ç¼–è¾‘æŒ‰é’®ï¼Œæ”¯æŒé¼ æ ‡æ‚¬åœæ˜¾ç¤ºç¼–è¾‘æŒ‰é’®ï¼Œå®ç°å­æ¡ç›®çš„æ—¶é—´å’Œå†…å®¹ç¼–è¾‘åŠŸèƒ½ï¼Œæå‡ç‰ˆæœ¬ç®¡ç†çš„çµæ´»æ€§ã€‚',
        _id: '68a1bddb1c7dfd7cf49361d4'
      }
    ],
    createdAt: '2025-08-17T11:32:43.000Z',
    updatedAt: '2025-08-17T11:32:43.000Z',
    createdBy: '68a1879069cfaf155ed2826f',
    updatedBy: '68a1879069cfaf155ed2826f',
    __v: 1
  },
  {
    _id: '68a1701c056620d1d553aa51',
    version: 'v5.0.4',
    order: 58,
    time: '2025.08.16 18:00:00',
    content: [
      {
        itemTime: '[2025/08/16 20:30:00]',
        itemContent: "ä¿®å¤MongoDBè¿æ¥é…ç½®ï¼šæ›´æ–°OneLove-backend/config.envæ–‡ä»¶ä¸­çš„MongoDBè¿æ¥å­—ç¬¦ä¸²ï¼Œæ·»åŠ æ•°æ®åº“åç§°'onelove'åˆ°è¿æ¥URLä¸­ï¼Œç¡®ä¿æ•°æ®åº“è¿æ¥æŒ‡å‘æ­£ç¡®çš„æ•°æ®åº“å®ä¾‹ï¼Œè§£å†³å¯èƒ½çš„æ•°æ®åº“è¿æ¥é—®é¢˜ã€‚",
        _id: '68a1701c056620d1d553aa52'
      },
      {
        itemTime: '[2025/08/16 20:35:00]',
        itemContent: 'å®Œå–„changelogæ•°æ®åŒæ­¥ï¼šåˆ›å»ºsync-changelog.jsè„šæœ¬ï¼Œå®ç°æœ¬åœ°changelog.jsæ–‡ä»¶æ•°æ®åˆ°äº‘ç«¯æ•°æ®åº“çš„è‡ªåŠ¨åŒæ­¥åŠŸèƒ½ï¼Œç¡®ä¿ç‰ˆæœ¬è®°å½•åœ¨äº‘ç«¯å’Œæœ¬åœ°ä¿æŒä¸€è‡´ï¼Œæ”¯æŒæ‰¹é‡æ•°æ®è¿ç§»å’Œæ›´æ–°ã€‚',
        _id: '68a1701c056620d1d553aa53'
      },
      {
        itemTime: '[2025/08/16 20:40:00]',
        itemContent: "ä¼˜åŒ–æœåŠ¡å™¨å¯åŠ¨æµç¨‹ï¼šä¿®å¤server.jsæ–‡ä»¶ä¸­ç¼ºå°‘çš„æœåŠ¡å™¨å¯åŠ¨ä»£ç ï¼Œæ·»åŠ å®Œæ•´çš„æ•°æ®åº“è¿æ¥æ£€æŸ¥å’ŒæœåŠ¡å™¨ç›‘å¬é€»è¾‘ï¼Œç¡®ä¿æœåŠ¡å™¨èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨å¹¶æ˜¾ç¤ºè¯¦ç»†çš„å¯åŠ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ•°æ®åº“çŠ¶æ€ã€APIæ–‡æ¡£åœ°å€ç­‰ã€‚",
        _id: '68a1701c056620d1d553aa54'
      },
      {
        itemTime: '[2025/08/16 20:45:00]',
        itemContent: 'è§£å†³helmetä¸­é—´ä»¶å†²çªï¼šç§»é™¤onelove-backend/server.jsä¸­æœªä½¿ç”¨çš„helmetä¸­é—´ä»¶å¯¼å…¥ï¼Œé¿å…ä¸Windowsæ–‡ä»¶ç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿå¯¼è‡´çš„è·¯å¾„å†²çªé—®é¢˜ï¼Œç¡®ä¿æœåŠ¡å™¨èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨è€Œä¸ä¼šå‡ºç°æ¨¡å—å¯¼å…¥é”™è¯¯ã€‚',
        _id: '68a1701c056620d1d553aa55'
      },
      {
        itemTime: '[2025/08/16 20:50:00]',
        itemContent: 'äº‘ç«¯changelogæ•°æ®ä¿®å¤ï¼šå‘ç°äº‘ç«¯æ•°æ®åº“ä¸­çš„changelogè®°å½•contentå­—æ®µè¢«é”™è¯¯ä¿å­˜ä¸ºå­—ç¬¦ä¸²æ ¼å¼ï¼Œåˆ›å»ºæ•°æ®ä¿®å¤è„šæœ¬å°†æœ¬åœ°changelog.jsæ–‡ä»¶ä¸­çš„æ­£ç¡®æ•°æ®åŒæ­¥åˆ°äº‘ç«¯ï¼Œç¡®ä¿ç‰ˆæœ¬è®°å½•å†…å®¹å®Œæ•´å‡†ç¡®ã€‚',
        _id: '68a1701c056620d1d553aa56'
      },
      {
        itemTime: '[2025/08/16 20:55:00]',
        itemContent: 'é¡¹ç›®æ—¥å¿—ç®¡ç†ä¼˜åŒ–ï¼šå®ç°æœ¬åœ°changelog.jsä¸äº‘ç«¯æ•°æ®åº“çš„åŒå‘åŒæ­¥æœºåˆ¶ï¼Œæ”¯æŒç‰ˆæœ¬è®°å½•çš„æ‰¹é‡æ›´æ–°å’Œå®æ—¶åŒæ­¥ï¼Œæå‡é¡¹ç›®å¼€å‘è®°å½•çš„ç®¡ç†æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚',
        _id: '68a1701c056620d1d553aa57'
      },
      {
        itemTime: '[2025-08-17 10:17:19]',
        itemContent: 'å®ç°æ›´æ–°æ—¥å¿—æƒé™ç®¡ç†ç³»ç»Ÿï¼šä¸ºå¼€å‘è€…å’Œç®¡ç†å‘˜ç”¨æˆ·æ·»åŠ æ›´æ–°æ—¥å¿—ç®¡ç†æƒé™ï¼Œå¼€å‘è€…å¯ä»¥æ·»åŠ ã€åˆ é™¤ã€ç®¡ç†æ‰€æœ‰ç‰ˆæœ¬å’Œæ¡ç›®ï¼Œç®¡ç†å‘˜åªèƒ½æ·»åŠ æ¡ç›®åˆ°ç°æœ‰ç‰ˆæœ¬ï¼Œå®ç°åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ã€‚',
        _id: '68a1bc361c7dfd7cf4935a2a'
      },
      {
        itemTime: '[2025-08-17 10:18:04]',
        itemContent: 'ä¼˜åŒ–æ›´æ–°æ—¥å¿—æ•°æ®ç»“æ„ï¼šå°†æ›´æ–°æ—¥å¿—åˆ†ä¸ºç‰ˆæœ¬å’Œæ¡ç›®ä¸¤ä¸ªå±‚çº§ï¼Œç‰ˆæœ¬ç”±å¼€å‘è€…å’Œç®¡ç†å‘˜åˆ›å»ºï¼Œæ¡ç›®ç”±ç®¡ç†å‘˜æ·»åŠ åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œæ¯ä¸ªæ¡ç›®è‡ªåŠ¨ç”Ÿæˆç²¾ç¡®åˆ°ç§’çš„æ—¶é—´æˆ³ã€‚',
        _id: '68a1bc701c7dfd7cf49360a7'
      },
      {
        itemTime: '[2025-08-17 10:18:29]',
        itemContent: 'ä¿®å¤æ›´æ–°æ—¥å¿—APIè·¯ç”±å†²çªï¼šè§£å†³Expressè·¯ç”±å®šä¹‰é¡ºåºé—®é¢˜ï¼Œç¡®ä¿æ›´å…·ä½“çš„è·¯ç”±ï¼ˆå¦‚/api/changelog/:versionId/itemsï¼‰åœ¨é€šç”¨è·¯ç”±ï¼ˆå¦‚/api/changelog/:idï¼‰ä¹‹å‰å®šä¹‰ï¼Œé¿å…è·¯ç”±åŒ¹é…å†²çªã€‚',
        _id: '68a1bc661c7dfd7cf4935f5c'
      },
      {
        itemTime: '[2025-08-17 10:18:35]',
        itemContent: 'å®Œå–„å‰ç«¯æ›´æ–°æ—¥å¿—ç®¡ç†ç•Œé¢ï¼šæ·»åŠ ç‰ˆæœ¬æ·»åŠ æŒ‰é’®å’Œæ¡ç›®æ·»åŠ æŒ‰é’®ï¼Œå®ç°åŠ¨æ€è¡¨å•åˆ›å»ºå’Œæäº¤åŠŸèƒ½ï¼Œæ”¯æŒå®æ—¶æ•°æ®åˆ·æ–°å’Œç”¨æˆ·å‹å¥½çš„æ“ä½œåé¦ˆã€‚',
        _id: '68a1bc5d1c7dfd7cf4935e11'
      },
      {
        itemTime: '[2025-08-17 10:19:11]',
        itemContent: 'è§£å†³æœåŠ¡å™¨è·¯ç”±æ³¨å†Œé—®é¢˜ï¼šé€šè¿‡é‡æ–°ç»„ç»‡è·¯ç”±å®šä¹‰é¡ºåºï¼Œç¡®ä¿æ‰€æœ‰APIç«¯ç‚¹æ­£ç¡®æ³¨å†Œï¼Œè§£å†³404é”™è¯¯é—®é¢˜ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ã€‚',
        _id: '68a1bc521c7dfd7cf4935cc6'
      },
      {
        itemTime: '[2025-08-17 10:19:20]',
        itemContent: 'ä¼˜åŒ–ç”¨æˆ·æƒé™éªŒè¯æœºåˆ¶ï¼šæ”¹è¿›JWTä»¤ç‰ŒéªŒè¯å’Œè§’è‰²æ£€æŸ¥é€»è¾‘ï¼Œå®ç°æ›´ç²¾ç¡®çš„æƒé™æ§åˆ¶ï¼Œç¡®ä¿ä¸åŒè§’è‰²ç”¨æˆ·åªèƒ½æ‰§è¡Œå…¶æƒé™èŒƒå›´å†…çš„æ“ä½œã€‚',
        _id: '68a1bc461c7dfd7cf4935b7b'
      }
    ],
    createdAt: '2025-08-17T06:01:00.852Z',
    updatedAt: '2025-08-17T11:26:40.434Z',
    createdBy: '68a1879069cfaf155ed2826f',
    updatedBy: '68a1879069cfaf155ed2826f',
    __v: 12
  }
];

async function restoreDeletedChangelog() {
  try {
    console.log('ğŸ”— æ­£åœ¨è¿æ¥æ•°æ®åº“...');
    
    await mongoose.connect(mongoURI, {
      serverSelectionTimeoutMS: 30000,
      socketTimeoutMS: 60000
    });

    console.log('âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ');

    let restoredCount = 0;
    let skippedCount = 0;

    for (const data of deletedData) {
      try {
        // ç›´æ¥åˆ›å»ºæ–°çš„changelogè®°å½•ï¼Œä¸æ£€æŸ¥æ˜¯å¦å­˜åœ¨
        const changelog = new Changelog(data);
        await changelog.save();
        
        console.log(`âœ… æˆåŠŸæ¢å¤ç‰ˆæœ¬ ${data.version} (${data.content.length} ä¸ªæ¡ç›®)`);
        restoredCount++;
        
      } catch (error) {
        if (error.code === 11000) {
          console.log(`âš ï¸  ç‰ˆæœ¬ ${data.version} å·²å­˜åœ¨ï¼Œè·³è¿‡æ¢å¤`);
          skippedCount++;
        } else {
          console.error(`âŒ æ¢å¤ç‰ˆæœ¬ ${data.version} å¤±è´¥:`, error.message);
        }
      }
    }

    console.log('\nğŸ“Š æ¢å¤ç»“æœç»Ÿè®¡:');
    console.log(`âœ… æˆåŠŸæ¢å¤: ${restoredCount} ä¸ªç‰ˆæœ¬`);
    console.log(`âš ï¸  è·³è¿‡å·²å­˜åœ¨: ${skippedCount} ä¸ªç‰ˆæœ¬`);
    console.log(`ğŸ“ æ€»è®¡å¤„ç†: ${deletedData.length} ä¸ªç‰ˆæœ¬`);

  } catch (error) {
    console.error('âŒ æ•°æ®åº“è¿æ¥å¤±è´¥:', error.message);
  } finally {
    await mongoose.disconnect();
    console.log('ğŸ”Œ æ•°æ®åº“è¿æ¥å·²å…³é—­');
  }
}

// è¿è¡Œæ¢å¤è„šæœ¬
restoreDeletedChangelog();
